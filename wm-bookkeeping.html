<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西瓜账本</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: #fafafa;
            color: #262626;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        .container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            height: 100vh;
            max-height: 800px; /* 添加最大高度限制 */
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 防止内容溢出 */
        }
        
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding-bottom: 80px; /* 保证底部内容不被导航栏遮挡 */
            box-sizing: border-box;
            display: none;
            -webkit-overflow-scrolling: touch;
            max-height: calc(100% - 60px); /* 减去头部高度 */
        }
        
        .page.active {
            display: block;
        }
        
        /* 头部样式 - 西瓜主题 */
        .header {
            background: white;
            color: #262626;
            padding: 12px 16px;
            border-bottom: 1px solid #dbdbdb;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 {
            font-size: 21px;
            font-weight: 600;
            text-align: center;
            flex: 1;
            color: #2ecc71;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .header-icon:hover {
            opacity: 1;
        }
        
        .header-left {
            width: 32px;
        }
        
        .header-right {
            width: 32px;
            font-size: 20px;
            cursor: pointer;
        }
        
        .watermelon-icon {
            font-size: 24px;
            margin-right: 8px;
            color: #2ecc71;
        }
        
        /* 海滩装饰元素 */
        .beach-decoration {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            opacity: 0.15;
            z-index: 1;
        }
        
        /* 天气板块 */
        .weather-module {
            background: linear-gradient(to right, #36d1dc, #5b86e5);
            color: white;
            padding: 15px;
            margin: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }
        
        .weather-sunny {
            background: linear-gradient(to right, #36d1dc, #5b86e5);
        }
        
        .weather-rainy {
            background: linear-gradient(to right, #6e7f91, #a2b5cd);
        }
        
        .weather-polluted {
            background: linear-gradient(to right, #d3a95c, #e6c78b);
        }
        
        .weather-night {
            background: linear-gradient(to right, #172b4d, #334c7d);
        }
        
        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .weather-icon {
            font-size: 30px;
            margin-right: 10px;
            animation: pulse 2s infinite ease-in-out;
        }
        
        .weather-temp {
            font-size: 28px;
            font-weight: 300;
        }
        
        .weather-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .clothing-advice {
            margin-top: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 14px;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* 底部导航 - 西瓜主题 */
        .bottom-nav {
            position: absolute; /* 改为absolute定位 */
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0 6px;
            border-top: 1px solid #dbdbdb;
            z-index: 1000;
        }
        
        .nav-item {
            padding: 4px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #262626;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
            position: relative;
        }
        
        .nav-icon i {
            transition: transform 0.2s;
        }
        
        .nav-text {
            font-size: 11px;
            font-weight: 400;
        }
        
        .nav-item.active .nav-icon i {
            transform: scale(1.1);
            color: #2ecc71;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #2ecc71;
            border-radius: 50%;
        }
        
        /* 添加按钮 - 海滩主题 */
        .add-button {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, #36d1dc, #5b86e5);
            color: white;
            border-radius: 50%;
            position: absolute;
            bottom: 80px;
            right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 3px 10px rgba(54,209,220,0.3);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 990;
        }
        
        .add-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(54,209,220,0.4);
        }
        
        .add-button::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 5px,
                rgba(255,255,255,0.1) 5px,
                rgba(255,255,255,0.1) 10px
            );
            opacity: 0.3;
            z-index: -1;
        }
        
        .beach-plus {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        /* 记账区域 */
        .account-section {
            padding: 15px;
            margin-top: 10px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #333;
        }
        
        .account-summary {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .summary-label {
            color: #666;
            font-size: 14px;
        }
        
        .summary-value {
            font-weight: 500;
            font-size: 15px;
        }
        
        .expense {
            color: #e74c3c;
        }
        
        .income {
            color: #2ecc71;
        }
        
        .transaction-list {
            margin-bottom: 70px;
        }
        
        /* 账单明细样式 */
        .transaction-item {
            position: relative;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
            background: white;
            border-bottom: 1px solid #f1f1f1;
        }

        .transaction-content {
            position: relative;
            background: white;
            transition: transform 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
        }

        .transaction-info {
            display: flex;
            align-items: center;
        }

        .category-icon {
            width: 36px;
            height: 36px;
            background: #f0f7ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
            color: #4a90e2;
            transition: transform 0.2s ease;
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-title {
            font-size: 15px;
            font-weight: 500;
        }

        .transaction-date {
            font-size: 12px;
            color: #999;
            margin-top: 3px;
        }

        .transaction-amount {
            font-weight: 500;
        }

        .transaction-amount.expense {
            color: #e74c3c;
        }

        .transaction-amount.income {
            color: #2ecc71;
        }

        .delete-action {
            position: absolute;
            right: -80px;
            top: 0;
            height: 100%;
            width: 80px;
            background: #e74c3c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: right 0.3s ease;
            cursor: pointer;
        }

        .transaction-item.swiping .transaction-content {
            transform: translateX(-80px);
        }

        .transaction-item.swiping .delete-action {
            right: 0;
        }

        /* 添加触摸滑动相关样式 */
        .transaction-item {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* 模态窗口样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            transition: transform 0.3s ease-out;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .modal.show .modal-content {
            transform: translateX(-50%) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.5rem;
        }

        .close-modal {
            font-size: 24px;
            color: #666;
            cursor: pointer;
        }

        .modal-body {
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            margin-top: 20px;
            text-align: right;
        }

        /* 钱包列表样式 */
        .wallet-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .wallet-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .wallet-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .wallet-info {
            flex: 1;
        }

        .wallet-name {
            font-weight: 500;
            color: #333;
        }

        .wallet-balance {
            color: #666;
            font-size: 0.9rem;
        }

        /* 预算列表样式 */
        .budget-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .budget-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .budget-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .budget-name {
            font-weight: 500;
            color: #333;
        }

        .budget-progress {
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #405de6;
            border-radius: 3px;
        }

        .budget-amount {
            color: #666;
            font-size: 0.9rem;
        }

        /* 通知列表样式 */
        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .notification-item:hover {
            background-color: #f0f0f0;
        }

        .notification-item.read {
            opacity: 0.7;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .notification-info {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .notification-content {
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .notification-time {
            color: #999;
            font-size: 0.8rem;
        }

        /* 设置列表样式 */
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .settings-item:active {
            transform: scale(0.98);
        }
        
        .settings-item:hover {
            box-shadow: 0 3px 8px rgba(0,0,0,0.07);
        }
        
        .settings-item-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .settings-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .settings-name {
            color: #333;
            font-weight: 500;
        }

        .settings-value {
            color: #666;
            display: flex;
            align-items: center;
        }

        /* 开关切换样式 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #2ecc71;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* 备份和清除数据按钮样式 */
        .backup-btn, .clear-data-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .backup-btn {
            background-color: #3498db;
        }

        .backup-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(52, 152, 219, 0.3);
        }
        
        .backup-btn:active {
            transform: translateY(0);
        }

        .clear-data-btn {
            background-color: #e74c3c;
        }

        .clear-data-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(231, 76, 60, 0.3);
        }
        
        .clear-data-btn:active {
            transform: translateY(0);
        }
        
        /* 语言选择器样式 */
        .language-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fff;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            min-width: 120px;
        }
        
        .language-select:hover {
            border-color: #3498db;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.15);
        }
        
        .language-select:focus {
            border-color: #2ecc71;
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.2);
        }

        /* 帮助列表样式 */
        .help-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .help-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .help-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .help-info {
            flex: 1;
        }

        .help-title {
            font-weight: 500;
            color: #333;
        }

        .help-content {
            color: #666;
            font-size: 0.9rem;
        }

        /* 关于我们样式 */
        .about-content {
            text-align: center;
            padding: 20px;
        }

        .app-logo {
            font-size: 48px;
            color: #405de6;
            margin-bottom: 15px;
        }

        .app-name {
            font-size: 24px;
            font-weight: 500;
            color: #333;
            margin-bottom: 10px;
        }

        .app-version {
            color: #666;
            margin-bottom: 15px;
        }

        .app-description {
            color: #666;
            line-height: 1.5;
        }

        /* 头像编辑样式 */
        .avatar-edit-content {
            text-align: center;
            padding: 20px;
        }

        .current-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #eee;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .current-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .avatar-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .upload-btn:hover {
            background: #2980b9;
        }

        .avatar-hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* 按钮样式 */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn-save {
            background-color: #405de6;
            color: white;
        }

        .btn-save:hover {
            background-color: #3448c5;
        }

        .btn-cancel {
            background-color: #e9ecef;
            color: #333;
        }

        .btn-cancel:hover {
            background-color: #dee2e6;
        }
        
        /* 动画 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes rain-fall {
            0% {
                transform: translateY(-20px);
            }
            100% {
                transform: translateY(100%);
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
            }
            to {
                transform: translate(-50%, 0);
            }
        }

        /* 雨滴动画 */
        .rain-drops {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.6;
        }
        
        .rain-drop {
            position: absolute;
            background: rgba(255,255,255,0.7);
            width: 2px;
            height: 15px;
            border-radius: 50%;
            animation: rain-fall linear infinite;
        }
        
        .weather-rainy .rain-drops {
            display: block;
        }
        
        .weather-sunny .rain-drops,
        .weather-polluted .rain-drops,
        .weather-night .rain-drops {
            display: none;
        }
        
        /* 统计页面样式 */
        .stats-period-selector {
            display: flex;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .period-option {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .period-option.active {
            background: #4a90e2;
            color: white;
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stats-card-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stats-card-value {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .stats-card-compare {
            font-size: 12px;
            color: #999;
        }
        
        .stats-card-compare span {
            color: #333;
            margin-right: 5px;
        }
        
        .stats-section {
            margin-bottom: 20px;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .chart-container canvas {
            height: 300px !important;
            width: 100% !important;
        }
        
        .chart-placeholder {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 150px;
            padding: 15px 0 25px;
        }
        
        .chart-bar {
            width: 12%;
            background: #f0f7ff;
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .chart-bar.active {
            background: #4a90e2;
        }
        
        .chart-bar span {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #999;
        }
        
        .category-stats {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .category-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .category-stat-item:last-child {
            border-bottom: none;
        }
        
        .category-stat-info {
            display: flex;
            align-items: center;
        }
        
        .category-stat-icon {
            width: 36px;
            height: 36px;
            background: #f0f7ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
            color: #4a90e2;
        }
        
        .category-stat-name {
            font-weight: 500;
            font-size: 15px;
        }
        
        .category-stat-percent {
            font-size: 12px;
            color: #999;
            margin-top: 3px;
        }
        
        .category-stat-amount {
            font-weight: 500;
        }
        
        /* 账单页面样式 */
        .bills-filter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        
        .date-filter i {
            margin-right: 5px;
            color: #4a90e2;
        }
        
        .date-filter i:last-child {
            margin-left: 5px;
            margin-right: 0;
            font-size: 12px;
            color: #999;
        }
        
        .type-filter {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .filter-option {
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-option.active {
            background: #4a90e2;
            color: white;
        }
        
        .bills-summary {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .bills-date-group {
            margin-bottom: 15px;
        }
        
        .date-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f9f9f9;
            border-radius: 10px 10px 0 0;
        }
        
        .date-title {
            font-weight: 500;
            font-size: 14px;
        }
        
        .date-summary {
            font-size: 13px;
        }
        
        .date-summary span {
            margin-left: 10px;
        }
        
        .bills-list .transaction-item {
            background: white;
        }
        
        /* 个人中心页面样式 */
        .profile-card {
            background: white;
            padding: 20px;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            position: relative;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .default-avatar-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            color: #aaa;
            font-size: 30px;
            border-radius: 50%;
        }
        
        .avatar-placeholder-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(200, 200, 200, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: #888;
        }
        
        .profile-edit-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            text-align: center;
            padding: 4px 0;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .profile-avatar:hover .profile-edit-overlay {
            opacity: 1;
        }
        
        .profile-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .profile-subtitle {
            font-size: 13px;
            color: #999;
        }
        
        .profile-stats {
            background: white;
            border-radius: 12px;
            display: flex;
            margin: 0 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stats-item {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            border-right: 1px solid #f5f5f5;
        }
        
        .stats-item:last-child {
            border-right: none;
        }
        
        .stats-value {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .stats-label {
            font-size: 12px;
            color: #999;
        }
        
        .menu-group {
            background: white;
            border-radius: 12px;
            margin: 0 15px 20px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }
        
        .menu-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .menu-title {
            flex: 1;
            font-size: 15px;
        }
        
        .menu-arrow {
            color: #ccc;
        }
        
        /* 日期选择器样式 */
        .month-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .month-arrow {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .month-arrow:hover {
            background: #e0e0e0;
        }
        
        .month-title {
            font-weight: 500;
            font-size: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-size: 13px;
            color: #999;
            padding-bottom: 10px;
        }
        
        .calendar-day {
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background: #f5f5f5;
        }
        
        .calendar-day.today {
            border: 1px solid #4a90e2;
            color: #4a90e2;
        }
        
        .calendar-day.active {
            background: #4a90e2;
            color: white;
        }
        
        .calendar-day.disabled {
            color: #ddd;
            cursor: default;
        }
        
        /* Toast 消息提示 */
        .toast {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2000;
            pointer-events: none;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* 移动端适配 */
        @media (max-width: 414px) {
            .container {
                width: 100%;
                height: 100vh;
                overflow: hidden;
            }
            
            .add-button {
                bottom: 80px;
                right: 15px;
            }
            
            .modal-content {
                border-radius: 20px 20px 0 0;
            }
        }
        
        /* 修复主页滚动条问题 */
        #homePage, #statisticsPage, #billsPage, #profilePage {
            padding-top: 60px; /* 头部导航的高度 */
        }
        
        /* 交易详情样式 */
        .detail-header {
            padding: 30px 0;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .detail-category {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .detail-category .category-icon {
            width: 50px;
            height: 50px;
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .detail-category .category-name {
            font-size: 16px;
            color: #666;
        }
        
        .detail-amount {
            font-size: 26px;
            font-weight: 500;
        }
        
        .detail-info {
            margin-bottom: 30px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .detail-label {
            color: #666;
        }
        
        .detail-actions {
            display: flex;
            justify-content: space-between;
        }
        
        .detail-actions button {
            flex: 1;
            margin: 0 5px;
        }
        
        /* 无数据提示 */
        .no-data {
            text-align: center;
            padding: 30px 0;
            color: #999;
            font-size: 14px;
        }
        
        /* 国际化支持 */
        .language-selector {
            position: absolute;
            top: 12px;
            right: 16px;
            z-index: 1000;
        }
        
        .language-selector select {
            padding: 4px 8px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }
        
        /* 图片编辑增强 */
        .image-editor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .image-editor.active {
            display: flex;
        }
        
        .image-preview {
            max-width: 90%;
            max-height: 70vh;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .image-editor-tools {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            margin-top: 20px;
        }
        
        .image-tool {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }
        
        .image-tool:hover {
            transform: scale(1.1);
            background: #f0f0f0;
        }
        
        .image-tool.active {
            background: #2ecc71;
            color: white;
        }
        
        .file-input {
            display: none;
        }
        
        /* 预算管理增强 */
        .budget-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .budget-progress {
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .budget-bar {
            height: 100%;
            background: linear-gradient(to right, #36d1dc, #5b86e5);
            transition: width 0.3s ease;
        }
        
        .budget-warning {
            background: linear-gradient(to right, #ff9a9e, #fad0c4);
        }
        
        .budget-danger {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
        }
        
        /* 本地通知 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-icon {
            font-size: 20px;
            color: #2ecc71;
        }
        
        .notification-message {
            font-size: 14px;
            color: #262626;
        }

        /* 搜索相关样式 */
        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .search-filters {
            display: flex;
            gap: 15px;
        }

        .search-filters label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
        }

        .search-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .result-info {
            flex: 1;
        }

        .result-category {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .result-note {
            color: #666;
            font-size: 14px;
        }

        .result-date {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        .result-amount {
            font-weight: 500;
        }

        .result-amount.expense {
            color: #e74c3c;
        }

        .result-amount.income {
            color: #2ecc71;
        }

        /* FAQ相关样式 */
        .faq-list {
            max-height: 70vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .faq-item {
            border-bottom: none;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f8f9fa;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 0;
        }
        
        .faq-item:hover {
            box-shadow: 0 3px 8px rgba(0,0,0,0.07);
        }

        .faq-question {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .faq-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .faq-question i:last-child {
            margin-left: auto;
            transition: transform 0.3s;
            color: #999;
        }

        .faq-answer {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease-out;
            color: #666;
            line-height: 1.5;
            background-color: #fff;
            margin: 0 15px 15px;
            border-radius: 8px;
        }

        /* 通知相关样式 */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            font-size: 12px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .notification-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .notification-count {
            color: #666;
            font-weight: 500;
        }

        .btn-mark-all {
            padding: 8px 12px;
            border: none;
            background: #f5f5f5;
            border-radius: 6px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .btn-mark-all:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-mark-all:active {
            transform: translateY(0);
        }

        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .notification-item:hover {
            background-color: #f0f0f0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.07);
            transform: translateY(-2px);
        }
        
        .notification-item:active {
            transform: scale(0.98);
        }

        .notification-item.read {
            opacity: 0.7;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .notification-info {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .notification-content {
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .notification-time {
            color: #999;
            font-size: 0.8rem;
        }

        /* 主题相关样式 */
        :root {
            --color-primary: #2ecc71;
            --color-secondary: #405de6;
            --color-background: #fafafa;
            --color-card: #ffffff;
            --color-text: #262626;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-text);
        }

        .container {
            background: var(--color-card);
        }

        .header {
            background: var(--color-card);
        }

        .nav-item.active {
            color: var(--color-primary);
        }

        .add-button {
            background: var(--color-primary);
        }

        /* 响应式调整 */
        @media (max-width: 414px) {
            .modal-content {
                width: 100%;
                height: 100%;
                margin: 0;
                border-radius: 0;
            }

            .search-filters {
                flex-wrap: wrap;
            }

            .notification-item {
                padding: 10px;
            }
        }

        /* 动画效果 */
        @keyframes slideIn {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .modal-content {
            animation: slideIn 0.3s ease-out;
        }

        /* 添加交易表单样式 */
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .type-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .type-option.active {
            background: #2ecc71;
            color: white;
        }

        .amount-input {
            position: relative;
            margin-bottom: 20px;
        }

        .amount-input .currency {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .amount-input input {
            width: 100%;
            padding: 12px 12px 12px 30px;
            font-size: 18px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        /* 分类选择器样式 */
        .category-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .category-selector::-webkit-scrollbar {
            width: 4px;
        }

        .category-selector::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .category-selector::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }

        .category-selector::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            background: #f5f5f5;
        }

        .category-item.active {
            background: #f0f7ff;
        }

        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .category-name {
            font-size: 12px;
            color: #666;
        }

        /* 更多分类容器样式 */
        .more-categories-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            display: none;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }

        .more-categories-container.show {
            display: block;
            transform: translateY(0);
        }

        .more-categories-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            padding-right: 5px;
        }

        .more-categories-grid::-webkit-scrollbar {
            width: 4px;
        }

        .more-categories-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .more-categories-grid::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }

        .more-categories-grid::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .back-to-main {
            display: flex;
            align-items: center;
            color: #666;
            cursor: pointer;
            padding: 10px 0;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }

        .back-to-main i {
            margin-right: 8px;
        }

        /* 修改模态窗口内容区域样式 */
        .modal-body {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            padding-right: 5px;
        }

        .modal-body::-webkit-scrollbar {
            width: 4px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
        }

        .form-group input[type="date"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 14px;
        }

        /* 修复模态窗口样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .modal-content {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            transition: transform 0.3s ease-out;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .modal.show .modal-content {
            transform: translateX(-50%) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .close-modal {
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-footer button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        .btn-save {
            background: #2ecc71;
            color: white;
        }

        .btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        /* 预算管理相关样式 */
        .budget-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .budget-card h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .budget-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .budget-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .category-budget-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .category-budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .budget-input-group {
            flex: 1;
            margin-left: 15px;
        }

        .category-budget-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        /* 图标选择器样式 */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .icon-selector i {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .icon-selector i:hover {
            background: #e0e0e0;
        }

        .icon-selector i.selected {
            background: #2ecc71;
            color: white;
        }

        /* 预算卡片样式 */
        .budget-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .budget-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
        }

        .budget-edit {
            color: #666;
            cursor: pointer;
            padding: 5px;
        }

        .budget-edit:hover {
            color: #2ecc71;
        }

        .budget-progress {
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .budget-bar {
            height: 100%;
            background: linear-gradient(to right, #36d1dc, #5b86e5);
            transition: width 0.3s ease;
        }

        .budget-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        /* 侧滑删除样式 */
        .transaction-item {
            position: relative;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
        }

        .transaction-content {
            position: relative;
            background: white;
            transition: transform 0.3s ease;
        }

        .delete-action {
            position: absolute;
            right: -80px;
            top: 0;
            height: 100%;
            width: 80px;
            background: #e74c3c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: right 0.3s ease;
        }

        .transaction-item.swiping .transaction-content {
            transform: translateX(-80px);
        }

        .transaction-item.swiping .delete-action {
            right: 0;
        }

        /* 添加触摸滑动相关样式 */
        .transaction-item {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* 数据管理按钮样式 */
        .data-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 0 15px 20px;
            padding: 15px 0;
        }
        
        .data-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            width: 120px;
        }
        
        .data-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .data-action-btn i {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 8px;
        }
        
        .data-action-btn span {
            font-size: 14px;
            color: #333;
        }
        
        .menu-group {
            background: white;
            border-radius: 12px;
            margin: 0 15px 20px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* 清除数据按钮样式 */
        .btn-clear-data {
            padding: 6px 12px;
            background: #ffebeb;
            color: #e74c3c;
            border: 1px solid #e74c3c;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-clear-data:hover {
            background: #e74c3c;
            color: white;
        }

        /* 搜索功能样式 */
        .search-box {
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: #f5f5f5;
        }
        
        .search-filters {
            display: flex;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .search-filters label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .search-results {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .search-results .transaction-item {
            margin-bottom: 10px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .search-results .no-data {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 0;
            color: #999;
        }
        
        /* 开关样式 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #9b59b6;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 首页 -->
        <div class="page active" id="homePage">
            <div class="header">
                <div class="header-left"></div>
                <h1><span class="watermelon-icon">🍉</span>西瓜账本</h1>
                <div class="header-right">
                    <div class="header-icon" id="headerNotification" style="position: relative;">
                        <i class="far fa-bell"></i>
                        <div class="notification-badge">1</div>
                    </div>
                </div>
            </div>

            <!-- 天气模块 -->
            <div class="weather-module weather-sunny" id="weatherModule">
                <div class="weather-header">
                    <div style="display: flex; align-items: center;">
                        <div class="weather-icon" id="weatherIcon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div>
                            <div>今天的天气</div>
                            <div class="weather-temp">23°C</div>
                        </div>
                    </div>
                    <div>
                        <i class="fas fa-location-dot"></i> 北京
                    </div>
                </div>
                <div class="weather-details">
                    <div>湿度: 60%</div>
                    <div>风力: 微风</div>
                    <div>空气: 优</div>
                </div>
                <div class="clothing-advice">
                    <i class="fas fa-tshirt"></i> 建议穿T恤和短裤
                </div>
                
                <!-- 雨滴动画 (默认隐藏) -->
                <div class="rain-drops" id="rainDrops"></div>
            </div>

            <!-- 记账摘要 -->
            <div class="account-section">
                <div class="section-title">今日概况</div>
                <div class="account-summary">
                    <div class="summary-row">
                        <span class="summary-label">收入</span>
                        <span class="summary-value income">+ ¥0.00</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">支出</span>
                        <span class="summary-value expense">- ¥0.00</span>
                    </div>
                    <div class="summary-row" style="margin-top: 5px; padding-top: 10px; border-top: 1px dashed #eee;">
                        <span class="summary-label">结余</span>
                        <span class="summary-value">¥964.50</span>
                    </div>
                </div>

                <!-- 预算管理卡片 -->
                <div class="section-title">预算管理</div>
                <div class="budget-card">
                    <div class="budget-header">
                        <h3>本月预算</h3>
                        <div class="budget-edit" id="editBudget">
                            <i class="fas fa-edit"></i>
                        </div>
                    </div>
                    <div class="budget-progress">
                        <div class="budget-bar" id="budgetProgressBar"></div>
                    </div>
                    <div class="budget-info">
                        <span>已使用: <span id="budgetUsed">¥0.00</span></span>
                        <span>剩余: <span id="budgetRemaining">¥0.00</span></span>
                    </div>
                </div>

                <div class="section-title">近期账单</div>
                <div class="transaction-list">
                    <!-- 交易列表将通过 JavaScript 动态生成 -->
                </div>
            </div>
        </div>

        <!-- 统计页面 -->
        <div class="page" id="statisticsPage">
            <div class="header">
                <div class="header-left"></div>
                <h1><span class="watermelon-icon">🍉</span>消费统计</h1>
                <div class="header-right" id="statsDatePicker">
                    <i class="fas fa-calendar"></i>
                </div>
            </div>
            
            <div class="account-section">
                <div class="stats-period-selector">
                    <div class="period-option active">日</div>
                    <div class="period-option">周</div>
                    <div class="period-option">月</div>
                    <div class="period-option">年</div>
                </div>
                
                <div class="stats-summary">
                    <div class="stats-card">
                        <div class="stats-card-title">总支出</div>
                        <div class="stats-card-value expense">¥3,245.80</div>
                        <div class="stats-card-compare">
                            <span><i class="fas fa-arrow-up"></i> 12.5%</span>
                            较上月
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">总收入</div>
                        <div class="stats-card-value income">¥5,800.00</div>
                        <div class="stats-card-compare">
                            <span><i class="fas fa-arrow-up"></i> 5.2%</span>
                            较上月
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <div class="section-title">消费趋势</div>
                    <div class="chart-container">
                        <div class="chart-placeholder">
                            <div class="chart-bar" style="height:30%"><span>一</span></div>
                            <div class="chart-bar" style="height:45%"><span>二</span></div>
                            <div class="chart-bar" style="height:25%"><span>三</span></div>
                            <div class="chart-bar" style="height:60%"><span>四</span></div>
                            <div class="chart-bar" style="height:75%"><span>五</span></div>
                            <div class="chart-bar" style="height:50%"><span>六</span></div>
                            <div class="chart-bar active" style="height:40%"><span>日</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <div class="section-title">消费占比</div>
                    <div class="chart-container">
                        <canvas id="expensePieChart"></canvas>
                    </div>
                </div>
                
                <div class="stats-section">
                    <div class="section-title">支出分类</div>
                    <div class="category-stats">
                        <div class="category-stat-item">
                            <div class="category-stat-info">
                                <div class="category-stat-icon">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div>
                                    <div class="category-stat-name">餐饮</div>
                                    <div class="category-stat-percent">32%</div>
                                </div>
                            </div>
                            <div class="category-stat-amount">¥1,038.65</div>
                        </div>
                        <div class="category-stat-item">
                            <div class="category-stat-info">
                                <div class="category-stat-icon" style="background:#fff0f0; color:#e74c3c;">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div>
                                    <div class="category-stat-name">购物</div>
                                    <div class="category-stat-percent">25%</div>
                                </div>
                            </div>
                            <div class="category-stat-amount">¥811.45</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 账单页面 -->
        <div class="page" id="billsPage">
            <div class="header">
                <div class="header-left"></div>
                <h1><span class="watermelon-icon">🍉</span>账单明细</h1>
                <div class="header-right">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            
            <div class="account-section">
                <div class="bills-filter">
                    <div class="date-filter" id="billsDateFilter">
                        <i class="fas fa-calendar"></i>
                        <span>2023年6月</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="type-filter">
                        <span class="filter-option active">全部</span>
                        <span class="filter-option">支出</span>
                        <span class="filter-option">收入</span>
                    </div>
                </div>
                
                <div class="bills-summary">
                    <div class="summary-row">
                        <span>收入</span>
                        <span class="income">¥5,800.00</span>
                    </div>
                    <div class="summary-row">
                        <span>支出</span>
                        <span class="expense">¥3,245.80</span>
                    </div>
                    <div class="summary-row">
                        <span>结余</span>
                        <span>¥2,554.20</span>
                    </div>
                </div>
                
                <div class="bills-list">
                    <div class="bills-date-group">
                        <div class="date-header">
                            <div class="date-title">今天</div>
                            <div class="date-summary">
                                <span class="expense">-¥268.40</span>
                                <span class="income">+¥1,200.00</span>
                            </div>
                        </div>
                        
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="category-icon">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">午餐</div>
                                    <div class="transaction-date" data-date="2023-06-01" data-time="12:30">12:30</div>
                                </div>
                            </div>
                            <div class="transaction-amount expense">-¥35.50</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 我的页面 -->
        <div class="page" id="profilePage">
            <div class="header">
                <div class="header-left"></div>
                <h1><span class="watermelon-icon">🍉</span>个人中心</h1>
                <div class="header-right"></div>
            </div>
            
            <!-- 用户信息 -->
            <div class="profile-card">
                <div class="profile-avatar">
                    <img src="https://i.ibb.co/rcsFm8X/watermelon-avatar.png" alt="用户头像" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="default-avatar-icon" style="display:none;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-edit-overlay">编辑</div>
                </div>
                <div class="profile-info">
                    <div class="profile-name">张小明</div>
                    <div class="profile-subtitle">记录生活每一笔</div>
                </div>
            </div>
            
            <!-- 数据管理按钮组 -->
            <div class="menu-group">
                <div class="menu-item" id="dataSync">
                    <div class="menu-icon" style="background:#e8fff0; color:#2ecc71;">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <div class="menu-title">云同步</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="menu-item" id="dataBackup">
                    <div class="menu-icon" style="background:#e8f4ff; color:#3498db;">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="menu-title">数据备份</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="menu-item" id="dataImport">
                    <div class="menu-icon" style="background:#f0f0ff; color:#9b59b6;">
                        <i class="fas fa-cloud-download-alt"></i>
                    </div>
                    <div class="menu-title">数据导入</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <!-- 功能菜单 -->
            <div class="menu-group">
                <div class="menu-item" id="budgetManagement">
                    <div class="menu-icon" style="background:#fff4e8; color:#fd1d1d;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="menu-title">预算管理</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="menu-item" id="notifications">
                    <div class="menu-icon" style="background:#e8fff0; color:#2ecc71;">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="menu-title">消息通知</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <div class="menu-group">
                <div class="menu-item" id="settings">
                    <div class="menu-icon" style="background:#f5f5f5; color:#666;">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="menu-title">设置</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="menu-item" id="commonQuestions">
                    <div class="menu-icon" style="background:#f5f5f5; color:#666;">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="menu-title">常见问题</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="menu-item" id="aboutUs">
                    <div class="menu-icon" style="background:#f5f5f5; color:#666;">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="menu-title">关于</div>
                    <div class="menu-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部导航 -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="homePage">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-text">首页</div>
            </div>
            <div class="nav-item" data-page="statisticsPage">
                <div class="nav-icon"><i class="fas fa-chart-pie"></i></div>
                <div class="nav-text">统计</div>
            </div>
            <div class="nav-item" data-page="billsPage">
                <div class="nav-icon"><i class="fas fa-list"></i></div>
                <div class="nav-text">账单</div>
            </div>
            <div class="nav-item" data-page="profilePage">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <div class="nav-text">我的</div>
            </div>
        </div>

        <!-- 添加按钮 -->
        <div class="add-button" id="addButton">
            <div class="beach-plus">
                <i class="fas fa-plus"></i>
            </div>
        </div>
    </div>

    <!-- 添加交易模态窗口 -->
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加记录</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="type-selector">
                    <div class="type-option active" data-type="expense">支出</div>
                    <div class="type-option" data-type="income">收入</div>
                </div>
                <div class="form-group">
                    <label>金额</label>
                    <div class="amount-input">
                        <span class="currency">¥</span>
                        <input type="number" id="amountInput" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>分类</label>
                    <div class="category-selector">
                        <div class="category-item" data-category="food">
                            <div class="category-icon">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="category-name">餐饮</div>
                        </div>
                        <div class="category-item" data-category="shopping">
                            <div class="category-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="category-name">购物</div>
                        </div>
                        <div class="category-item" data-category="transport">
                            <div class="category-icon">
                                <i class="fas fa-bus"></i>
                            </div>
                            <div class="category-name">交通</div>
                        </div>
                        <div class="category-item" data-category="entertainment">
                            <div class="category-icon">
                                <i class="fas fa-film"></i>
                            </div>
                            <div class="category-name">娱乐</div>
                        </div>
                        <div class="category-item" data-category="health">
                            <div class="category-icon">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <div class="category-name">医疗</div>
                        </div>
                        <div class="category-item" data-category="education">
                            <div class="category-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="category-name">教育</div>
                        </div>
                        <div class="category-item" data-category="travel">
                            <div class="category-icon">
                                <i class="fas fa-plane"></i>
                            </div>
                            <div class="category-name">旅行</div>
                        </div>
                        <div class="category-item" data-category="housing">
                            <div class="category-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="category-name">住房</div>
                        </div>
                        <div class="category-item" data-category="utilities">
                            <div class="category-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="category-name">水电</div>
                        </div>
                        <div class="category-item" data-category="more" id="moreCategories">
                            <div class="category-icon">
                                <i class="fas fa-ellipsis-h"></i>
                            </div>
                            <div class="category-name">更多</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>日期</label>
                    <input type="date" id="dateInput" max="">
                </div>
                <div class="form-group">
                    <label>备注</label>
                    <input type="text" id="noteInput" placeholder="添加备注">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" id="cancelTransaction">取消</button>
                <button class="btn btn-save" id="saveTransaction">保存</button>
            </div>
        </div>
    </div>

    <!-- 更多分类模态窗口 -->
    <div id="moreCategoriesContainer" class="more-categories-container">
        <div class="modal-header">
            <h2>选择分类</h2>
            <div class="back-to-main" id="backToMain">
                <i class="fas fa-arrow-left"></i> 返回
            </div>
        </div>
        <div class="more-categories-grid">
            <div class="category-item" data-category="gift">
                <div class="category-icon">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="category-name">礼物</div>
            </div>
            <div class="category-item" data-category="beauty">
                <div class="category-icon">
                    <i class="fas fa-spa"></i>
                </div>
                <div class="category-name">美容</div>
            </div>
            <div class="category-item" data-category="sports">
                <div class="category-icon">
                    <i class="fas fa-running"></i>
                </div>
                <div class="category-name">运动</div>
            </div>
            <div class="category-item" data-category="digital">
                <div class="category-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="category-name">数码</div>
            </div>
            <div class="category-item" data-category="pet">
                <div class="category-icon">
                    <i class="fas fa-paw"></i>
                </div>
                <div class="category-name">宠物</div>
            </div>
            <div class="category-item" data-category="book">
                <div class="category-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="category-name">书籍</div>
            </div>
            <div class="category-item" data-category="custom" id="addCustomCategory">
                <div class="category-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="category-name">自定义</div>
            </div>
        </div>
    </div>

    <!-- 自定义分类模态窗口 -->
    <div id="customCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加自定义分类</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>分类名称</label>
                    <input type="text" id="customCategoryName" placeholder="输入分类名称">
                </div>
                <div class="form-group">
                    <label>选择图标</label>
                    <div class="icon-selector">
                        <i class="fas fa-utensils" data-icon="fa-utensils"></i>
                        <i class="fas fa-shopping-bag" data-icon="fa-shopping-bag"></i>
                        <i class="fas fa-bus" data-icon="fa-bus"></i>
                        <i class="fas fa-film" data-icon="fa-film"></i>
                        <i class="fas fa-heartbeat" data-icon="fa-heartbeat"></i>
                        <i class="fas fa-graduation-cap" data-icon="fa-graduation-cap"></i>
                        <i class="fas fa-plane" data-icon="fa-plane"></i>
                        <i class="fas fa-home" data-icon="fa-home"></i>
                        <i class="fas fa-bolt" data-icon="fa-bolt"></i>
                        <i class="fas fa-gift" data-icon="fa-gift"></i>
                        <i class="fas fa-spa" data-icon="fa-spa"></i>
                        <i class="fas fa-running" data-icon="fa-running"></i>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" id="cancelCustomCategory">取消</button>
                <button class="btn btn-save" id="saveCustomCategory">保存</button>
            </div>
        </div>
    </div>

    <!-- 预算管理模态窗口 -->
    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>预算管理</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="budget-card">
                    <h3>月度总预算</h3>
                    <div class="form-group">
                        <input type="number" id="monthlyBudget" placeholder="输入月度预算金额" class="budget-input">
                    </div>
                    <div class="budget-progress">
                        <div class="budget-bar" style="width: 65%"></div>
                    </div>
                    <div class="budget-info">
                        <span>已使用: ¥3,245.80</span>
                        <span>剩余: ¥1,754.20</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" id="cancelBudget">取消</button>
                <button class="btn btn-save" id="saveBudget">保存</button>
            </div>
        </div>
    </div>

    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>消息通知</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 通知列表 -->
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>设置</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 设置选项 -->
            </div>
        </div>
    </div>

    <div id="commonQuestionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>常见问题</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 常见问题列表 -->
            </div>
        </div>
    </div>

    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>关于</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 关于我们内容 -->
            </div>
        </div>
    </div>

    <!-- 关于模态窗口 -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>关于</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 关于我们内容 -->
            </div>
        </div>
    </div>

    <!-- 搜索账单模态窗口 -->
    <div id="searchBillsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>搜索账单</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" id="billSearchInput" placeholder="搜索账单（输入分类、备注或金额）">
                </div>
                <div class="search-filters">
                    <label>
                        <input type="checkbox" id="searchExpense" checked>
                        <span>支出</span>
                    </label>
                    <label>
                        <input type="checkbox" id="searchIncome" checked>
                        <span>收入</span>
                    </label>
                </div>
                <div id="searchResults" class="search-results">
                    <!-- 搜索结果将在这里显示 -->
                    <div class="no-data" style="display: none;">
                        <i class="fas fa-search" style="font-size: 36px; color: #ccc; margin-bottom: 10px;"></i>
                        <p>没有找到相关账单</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 支出分类明细弹窗 -->
    <div id="categoryDetailModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="categoryDetailTitle">分类明细</h2>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body" id="categoryDetailBody">
          <!-- 明细内容JS生成 -->
        </div>
      </div>
    </div>

    <script>
        // DataStore 对象 - 数据管理
        const DataStore = {
            bills: [],
            categories: {
                expense: [
                    { id: 'food', name: '餐饮', icon: 'fa-utensils' },
                    { id: 'shopping', name: '购物', icon: 'fa-shopping-bag' },
                    { id: 'transport', name: '交通', icon: 'fa-bus' },
                    { id: 'entertainment', name: '娱乐', icon: 'fa-film' },
                    { id: 'health', name: '医疗', icon: 'fa-heartbeat' },
                    { id: 'education', name: '教育', icon: 'fa-graduation-cap' },
                    { id: 'travel', name: '旅行', icon: 'fa-plane' },
                    { id: 'housing', name: '住房', icon: 'fa-home' },
                    { id: 'utilities', name: '水电', icon: 'fa-bolt' },
                    { id: 'gift', name: '礼物', icon: 'fa-gift' },
                    { id: 'beauty', name: '美容', icon: 'fa-spa' },
                    { id: 'sports', name: '运动', icon: 'fa-running' },
                    { id: 'digital', name: '数码', icon: 'fa-mobile-alt' },
                    { id: 'pet', name: '宠物', icon: 'fa-paw' },
                    { id: 'book', name: '书籍', icon: 'fa-book' }
                ],
                income: [
                    { id: 'salary', name: '工资', icon: 'fa-money-bill-wave' },
                    { id: 'bonus', name: '奖金', icon: 'fa-coins' },
                    { id: 'investment', name: '投资', icon: 'fa-chart-line' },
                    { id: 'transfer', name: '转账', icon: 'fa-exchange-alt' },
                    { id: 'refund', name: '退款', icon: 'fa-undo' },
                    { id: 'loan', name: '借入', icon: 'fa-hand-holding-usd' },
                    { id: 'gift_income', name: '礼金', icon: 'fa-gift' }
                ]
            },
            budgets: {
                monthly: 5000,
                categories: {}
            },
            loadData() {
                try {
                    const savedData = localStorage.getItem('wm_bookkeeping_data');
                    if (savedData) {
                        const parsedData = JSON.parse(savedData);
                        this.bills = parsedData.bills || [];
                        this.categories = parsedData.categories || {
                            expense: [
                                { id: 'food', name: '餐饮', icon: 'fa-utensils' },
                                { id: 'shopping', name: '购物', icon: 'fa-shopping-bag' },
                                { id: 'transport', name: '交通', icon: 'fa-bus' },
                                { id: 'entertainment', name: '娱乐', icon: 'fa-film' },
                                { id: 'health', name: '医疗', icon: 'fa-heartbeat' },
                                { id: 'education', name: '教育', icon: 'fa-graduation-cap' },
                                { id: 'travel', name: '旅行', icon: 'fa-plane' },
                                { id: 'housing', name: '住房', icon: 'fa-home' },
                                { id: 'utilities', name: '水电', icon: 'fa-bolt' },
                                { id: 'gift', name: '礼物', icon: 'fa-gift' },
                                { id: 'beauty', name: '美容', icon: 'fa-spa' },
                                { id: 'sports', name: '运动', icon: 'fa-running' },
                                { id: 'digital', name: '数码', icon: 'fa-mobile-alt' },
                                { id: 'pet', name: '宠物', icon: 'fa-paw' },
                                { id: 'book', name: '书籍', icon: 'fa-book' }
                            ],
                            income: [
                                { id: 'salary', name: '工资', icon: 'fa-money-bill-wave' },
                                { id: 'bonus', name: '奖金', icon: 'fa-coins' },
                                { id: 'investment', name: '投资', icon: 'fa-chart-line' },
                                { id: 'transfer', name: '转账', icon: 'fa-exchange-alt' },
                                { id: 'refund', name: '退款', icon: 'fa-undo' },
                                { id: 'loan', name: '借入', icon: 'fa-hand-holding-usd' },
                                { id: 'gift_income', name: '礼金', icon: 'fa-gift' }
                            ]
                        };
                        this.budgets = parsedData.budgets || { 
                            monthly: 5000, 
                            categories: {} 
                        };
                    } else {
                        // 初始化测试数据
                        this.initializeTestData();
                    }
                    console.log('Data loaded successfully', this);
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.initializeTestData();
                }
            },
            saveData() {
                try {
                    localStorage.setItem('wm_bookkeeping_data', JSON.stringify({
                        bills: this.bills,
                        categories: this.categories,
                        budgets: this.budgets
                    }));
                    console.log('Data saved successfully');
                } catch (error) {
                    console.error('Error saving data:', error);
                    alert('保存数据失败，请检查浏览器存储设置');
                }
            },
            initializeTestData() {
                // 如果没有数据，初始化一些测试数据
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const twoDaysAgo = new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0];
                
                this.bills = [
                    { id: 1, amount: 35.5, type: 'expense', category: 'food', date: today, note: '午餐', timestamp: new Date().toISOString() },
                    { id: 2, amount: 120, type: 'expense', category: 'shopping', date: today, note: '超市购物', timestamp: new Date().toISOString() },
                    { id: 3, amount: 5000, type: 'income', category: 'salary', date: yesterday, note: '5月工资', timestamp: new Date().toISOString() },
                    { id: 4, amount: 25, type: 'expense', category: 'transport', date: yesterday, note: '打车', timestamp: new Date().toISOString() },
                    { id: 5, amount: 50, type: 'expense', category: 'entertainment', date: twoDaysAgo, note: '电影票', timestamp: new Date().toISOString() },
                    { id: 6, amount: 200, type: 'expense', category: 'health', date: twoDaysAgo, note: '感冒药', timestamp: new Date().toISOString() }
                ];
                
                // 默认预算
                this.budgets = {
                    monthly: 5000,
                    categories: {
                        food: 1000,
                        shopping: 800,
                        transport: 500
                    }
                };
                
                this.saveData();
                console.log('Test data initialized');
            },
            // ... DataStore其他函数保持不变 ...
            
            // 添加账单
            addBill(bill) {
                try {
                    this.bills.push(bill);
                    this.saveData();
                    return true;
                } catch (error) {
                    console.error('Error adding bill:', error);
                    return false;
                }
            },

            // 更新预算
            updateBudget(budget) {
                try {
                    if (budget.type === 'monthly') {
                        this.budgets.monthly = budget.amount;
                    } else {
                        this.budgets.categories[budget.category] = budget.amount;
                    }
                    this.saveData();
                    return true;
                } catch (error) {
                    console.error('Error updating budget:', error);
                    return false;
                }
            }
        };

        // 工具函数
        function showModal(modal) {
            if (!modal) {
                console.error('Modal element not found');
                return;
            }
            console.log('Showing modal:', modal.id);
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            // 添加延迟以确保过渡动画生效
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }

        function hideModal(modal) {
            if (!modal) {
                console.error('Modal element not found');
                return;
            }
            console.log('Hiding modal:', modal.id);
            modal.classList.remove('show');
            // 等待过渡动画完成后再隐藏
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded, initializing app...');
            
            // 初始化数据
            DataStore.loadData();
            
            // 加载用户之前选择的语言设置
            const savedLanguage = localStorage.getItem('app_language');
            if (savedLanguage) {
                changeAppLanguage(savedLanguage);
                
                // 更新语言选择器
                const languageSelector = document.getElementById('languageSelector');
                if (languageSelector) {
                    languageSelector.value = savedLanguage;
                }
            }

            // 加载用户头像
            const savedAvatar = localStorage.getItem('userAvatar');
            if (savedAvatar) {
                const profileAvatarImg = document.querySelector('.profile-avatar img');
                const defaultAvatarIcon = document.querySelector('.profile-avatar .default-avatar-icon');
                
                profileAvatarImg.src = savedAvatar;
                profileAvatarImg.style.display = 'block';
                defaultAvatarIcon.style.display = 'none';
            }

            // 右上角通知图标点击事件
            const headerNotification = document.getElementById('headerNotification');
            if (headerNotification) {
                headerNotification.addEventListener('click', function() {
                    console.log('Header notification clicked');
                    populateNotificationsModal();
                    showModal(document.getElementById('notificationsModal'));
                });
                
                // 显示通知徽章
                const unreadNotifications = getUnreadNotificationsCount();
                if (unreadNotifications > 0) {
                    const badge = headerNotification.querySelector('.notification-badge');
                    if (badge) {
                        badge.textContent = unreadNotifications;
                        badge.style.display = 'flex';
                    }
                }
            }

            // 设置账单页日期筛选器默认显示当前月份
            const billsDateFilter = document.getElementById('billsDateFilter');
            if (billsDateFilter) {
                const now = new Date();
                const currentMonth = now.getMonth() + 1;
                const currentYear = now.getFullYear();
                const dateSpan = billsDateFilter.querySelector('span');
                if (dateSpan) {
                    dateSpan.textContent = `${currentYear}年${currentMonth}月`;
                }
                
                // 监听日期筛选器点击事件
                billsDateFilter.addEventListener('click', function() {
                    showDatePickerModal('#billsDateFilter span', 'bills');
                });
            }
            
            // 加载页面数据
            updateTransactionList();
            updateSummary();
            updateBudgetDisplay();
            updateBillsList();
            updateBillsSummary();
            updateProfileSummary();
            
            // 初始化个人中心菜单项事件
            initProfilePageMenus();
            
            // 初始化时间显示
            updateTransactionTimes();
            
            // 初始化底部导航事件
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    console.log('Nav item clicked:', this.getAttribute('data-page'));
                    // 移除所有激活状态
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    // 添加当前导航项的激活状态
                    this.classList.add('active');
                    
                    // 隐藏所有页面
                    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                    
                    // 显示对应页面
                    const targetPageId = this.getAttribute('data-page');
                    const targetPage = document.getElementById(targetPageId);
                    if (targetPage) {
                        targetPage.classList.add('active');
                        
                        // 如果进入个人中心页，刷新个人中心数据
                        if (targetPageId === 'profilePage') {
                            updateProfileSummary();
                        }

                        // 刷新页面数据
                        refreshPageData(targetPageId);
                    }
                });
            });
            
            // 刷新页面数据的函数
            function refreshPageData(pageId) {
                switch(pageId) {
                    case 'homePage':
                        console.log('Refreshing home page data...');
                        updateTransactionList();
                        updateSummary();
                        updateBudgetDisplay();
                        break;
                        
                    case 'statisticsPage':
                        console.log('Refreshing statistics page data...');
                        const activePeriod = document.querySelector('.period-option.active');
                        const period = activePeriod ? activePeriod.textContent : '日';
                        console.log('Active period:', period);
                        updateStatistics(period);
                        break;
                        
                    case 'billsPage':
                        console.log('Refreshing bills page data...');
                        const dateFilterText = document.querySelector('#billsDateFilter span')?.textContent;
                        if (dateFilterText) {
                            const match = dateFilterText.match(/(\d+)年(\d+)月/);
                            if (match) {
                                const selectedDate = new Date(parseInt(match[1]), parseInt(match[2]) - 1, 1);
                                updateBillsListByDate(selectedDate);
                            } else {
                                updateBillsList();
                            }
                        } else {
                            updateBillsList();
                        }
                        updateBillsSummary();
                        break;
                        
                    case 'profilePage':
                        console.log('Refreshing profile page data...');
                        updateProfileSummary();
                        break;
                }
            }
            
            // 更新个人主页的摘要数据
            function updateProfileSummary() {
                try {
                    console.log('Updating profile summary...');
                    // 获取本月数据
                    const now = new Date();
                    const currentMonth = now.getMonth();
                    const currentYear = now.getFullYear();
                    
                    // 计算本月账单
                    const monthlyBills = DataStore.bills.filter(bill => {
                        const billDate = new Date(bill.date);
                        return billDate.getMonth() === currentMonth && 
                               billDate.getFullYear() === currentYear;
                    });
                    
                    // 计算收入和支出
                    const monthlyIncome = monthlyBills
                        .filter(bill => bill.type === 'income')
                        .reduce((sum, bill) => sum + bill.amount, 0);
                        
                    const monthlyExpense = monthlyBills
                        .filter(bill => bill.type === 'expense')
                        .reduce((sum, bill) => sum + bill.amount, 0);
                    
                    // 注意：当前UI中不再显示月度摘要信息
                    console.log('Profile summary data calculated: Income:', monthlyIncome, 'Expense:', monthlyExpense);
                    
                    console.log('Profile summary updated successfully');
                } catch (error) {
                    console.error('Error updating profile summary:', error);
                }
            }

            // 初始化各个页面的数据
            updateBillsList();
            updateBudgetList();
            updateTransactionList();
            updateSummary();
            
            // 初始化统计页面
            const periodOptions = document.querySelectorAll('.period-option');
            if (periodOptions && periodOptions.length > 0) {
                periodOptions.forEach(option => {
                    if (option.textContent === '日') {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                    
                    // 添加事件监听
                    option.addEventListener('click', function() {
                        console.log('Period option clicked:', this.textContent);
                        document.querySelectorAll('.period-option').forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        updateStatistics(this.textContent);
                    });
                });
                
                // 初始更新统计
                updateStatistics('日');
            }

            // 初始化预算显示
            updateBudgetDisplay();
            
            // 添加预算编辑按钮事件
            const editBudgetBtn = document.getElementById('editBudget');
            if (editBudgetBtn) {
                editBudgetBtn.addEventListener('click', function() {
                    console.log('Edit budget button clicked');
                    showModal(document.getElementById('budgetModal'));
                });
            }
            
            // 在保存预算时更新显示
            const budgetSaveBtn = document.getElementById('saveBudget');
            if (budgetSaveBtn) {
                budgetSaveBtn.addEventListener('click', function() {
                    console.log('Save budget button clicked');
                    const monthlyBudget = parseFloat(document.getElementById('monthlyBudget').value);
                    DataStore.budgets.monthly = monthlyBudget;
                    DataStore.saveData();
                    hideModal(document.getElementById('budgetModal'));
                    updateBudgetDisplay();
                });
            }

            // 类型切换（支出/收入）
            const typeOptions = document.querySelectorAll('.type-selector .type-option');
            if (typeOptions && typeOptions.length > 0) {
                typeOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        console.log('Type option clicked:', this.getAttribute('data-type'));
                        document.querySelectorAll('.type-selector .type-option').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                        const type = this.getAttribute('data-type');
                        updateCategorySelector(type);
                    });
                });
            }

            // 主分类选择
            const categoryItems = document.querySelectorAll('.category-selector .category-item');
            if (categoryItems && categoryItems.length > 0) {
                categoryItems.forEach(item => {
                    item.addEventListener('click', function() {
                        console.log('Category item clicked:', this.getAttribute('data-category'));
                        document.querySelectorAll('.category-selector .category-item').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                        const category = this.getAttribute('data-category');
                        if (category === 'more') {
                            const moreContainer = document.getElementById('moreCategoriesContainer');
                            if (moreContainer) {
                                moreContainer.classList.add('show');
                            }
                        }
                    });
                });
            }

            // 更多分类选择
            const moreCategoryItems = document.querySelectorAll('#moreCategoriesContainer .category-item');
            if (moreCategoryItems && moreCategoryItems.length > 0) {
                moreCategoryItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        console.log('More category item clicked:', category);
                        const moreContainer = document.getElementById('moreCategoriesContainer');
                        if (moreContainer) {
                            moreContainer.classList.remove('show');
                        }
                        // 更新主分类选择器
                        const mainCategoryItem = document.querySelector(`.category-selector .category-item[data-category="${category}"]`);
                        if (mainCategoryItem) {
                            document.querySelectorAll('.category-selector .category-item').forEach(i => i.classList.remove('active'));
                            mainCategoryItem.classList.add('active');
                        }
                    });
                });
            }

            // 返回主分类
            const backToMain = document.getElementById('backToMain');
            if (backToMain) {
                backToMain.addEventListener('click', function() {
                    console.log('Back to main clicked');
                    const moreContainer = document.getElementById('moreCategoriesContainer');
                    if (moreContainer) {
                        moreContainer.classList.remove('show');
                    }
                });
            }

            // 添加账单按钮
            const addButton = document.querySelector('.add-button');
            if (addButton) {
                addButton.addEventListener('click', function() {
                    console.log('Add button clicked');
                    const addTransactionModal = document.getElementById('addTransactionModal');
                    if (addTransactionModal) {
                        showModal(addTransactionModal);
                    }
                });
            }

            // 保存交易按钮事件
            const saveTransactionBtn = document.getElementById('saveTransaction');
            if (saveTransactionBtn) {
                saveTransactionBtn.addEventListener('click', function() {
                    console.log('Save transaction button clicked');
                    const amountInput = document.getElementById('amountInput');
                    const activeTypeOption = document.querySelector('.type-selector .type-option.active');
                    const activeCategoryItem = document.querySelector('.category-selector .category-item.active');
                    const dateInput = document.getElementById('dateInput');
                    const noteInput = document.getElementById('noteInput');

                    if (!amountInput || !activeTypeOption || !activeCategoryItem || !dateInput) {
                        console.error('Required form elements not found');
                        alert('表单元素缺失，请刷新页面重试');
                        return;
                    }

                    const amount = parseFloat(amountInput.value);
                    const type = activeTypeOption.getAttribute('data-type');
                    const category = activeCategoryItem?.getAttribute('data-category');
                    const date = dateInput.value;
                    const note = noteInput ? noteInput.value : '';

                    if (!amount || !category || !date) {
                        alert('请填写必要信息：金额、分类和日期');
                        return;
                    }

                    // 获取当前北京时间
                    const now = new Date();
                    // 北京时间比UTC快8小时
                    const beijingTime = new Date(now.getTime() + 8 * 60 * 60 * 1000);
                    const formattedTime = beijingTime.toISOString().substr(11, 8);
                    
                    const bill = {
                        id: Date.now(),
                        amount,
                        type,
                        category,
                        date,
                        note,
                        time: formattedTime,
                        timestamp: beijingTime.toISOString()
                    };

                    console.log('Adding bill:', bill);
                    // 添加账单
                    DataStore.addBill(bill);

                    // 关闭模态窗口
                    hideModal(document.getElementById('addTransactionModal'));

                    // 清空表单
                    amountInput.value = '';
                    if (noteInput) noteInput.value = '';

                    // 更新页面数据
                    updateBillsList();
                    updateTransactionList();
                    updateSummary();
                    updateBudgetDisplay();

                    // 如果当前在统计页面，更新统计数据
                    if (document.getElementById('statisticsPage').classList.contains('active')) {
                        const activePeriod = document.querySelector('.period-option.active');
                        if (activePeriod) {
                            updateStatistics(activePeriod.textContent);
                        }
                    }
                });
            }

            // 为所有关闭按钮添加事件监听
            document.querySelectorAll('.close-modal').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    console.log('Close modal button clicked');
                    const modal = this.closest('.modal');
                    hideModal(modal);
                });
            });

            // 点击模态窗口外部关闭
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        console.log('Modal background clicked, closing modal');
                        hideModal(this);
                    }
                });
            });

            // 取消按钮事件
            document.querySelectorAll('.btn-cancel').forEach(cancelBtn => {
                cancelBtn.addEventListener('click', function() {
                    console.log('Cancel button clicked');
                    const modal = this.closest('.modal');
                    hideModal(modal);
                });
            });

            // 账单页筛选
            const billTypeFilterItems = document.querySelectorAll('.type-filter-item');
            if (billTypeFilterItems && billTypeFilterItems.length > 0) {
                billTypeFilterItems.forEach(item => {
                    item.addEventListener('click', function() {
                        console.log('Bill type filter clicked:', this.getAttribute('data-type'));
                        document.querySelectorAll('.type-filter-item').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                        updateBillsList();
                    });
                });
            }

            // 账单日期筛选
            const dateFilterBtn = document.getElementById('dateFilterBtn');
            if (dateFilterBtn) {
                dateFilterBtn.addEventListener('click', function() {
                    console.log('Date filter button clicked');
                    const dateFilterModal = document.getElementById('dateFilterModal');
                    if (dateFilterModal) {
                        showModal(dateFilterModal);
                    }
                });
            }

            // 日期选择事件
            const monthSelector = document.getElementById('monthSelector');
            if (monthSelector) {
                monthSelector.addEventListener('change', function() {
                    console.log('Month selector changed:', this.value);
                    hideModal(document.getElementById('dateFilterModal'));
                    updateBillsListByDate(new Date(this.value));
                });
            }

            console.log('App initialization completed');
        });

        // 账单渲染相关函数
        function updateTransactionList(page = 1) {
            try {
                const transactionList = document.querySelector('.transaction-list');
                if (!transactionList) {
                    console.error('Transaction list element not found');
                    return;
                }

                // 清空列表或初始化
                if (page === 1) {
                    transactionList.innerHTML = '';
                    // 移除可能存在的加载更多按钮和底部提示
                    const existingLoadMore = document.getElementById('loadMoreTransactions');
                    if (existingLoadMore) existingLoadMore.remove();
                    const existingEndTip = document.getElementById('endOfTransactionsTip');
                    if (existingEndTip) existingEndTip.remove();
                }

                if (!DataStore.bills || DataStore.bills.length === 0) {
                    transactionList.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-receipt" style="font-size: 48px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>暂无账单记录</p>
                            <p style="font-size: 12px; color: #999; margin-top: 5px;">点击右下角"+"添加新账单</p>
                        </div>`;
                    return;
                }

                // 对账单按日期倒序排序
                const sortedBills = [...DataStore.bills].sort((a, b) => {
                    return new Date(b.date) - new Date(a.date);
                });

                // 分页处理
                const pageSize = 10; // 减少每页数量，提高加载速度
                const startIndex = (page - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const currentPageBills = sortedBills.slice(startIndex, endIndex);
                const hasMoreData = endIndex < sortedBills.length;

                const groupedTransactions = groupTransactionsByDate(currentPageBills);
                
                // 对日期组进行倒序排序
                const sortedDates = Object.keys(groupedTransactions).sort((a, b) => {
                    return new Date(b) - new Date(a);
                });
                
                // 创建一个文档片段以提高性能
                const fragment = document.createDocumentFragment();
                
                sortedDates.forEach(date => {
                    const transactions = groupedTransactions[date];
                    const dateGroup = document.createElement('div');
                    dateGroup.className = 'bills-date-group';
                    
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-header';
                    
                    const dateTitle = document.createElement('div');
                    dateTitle.className = 'date-title';
                    dateTitle.textContent = formatDate(date);
                    
                    const dateSummary = document.createElement('div');
                    dateSummary.className = 'date-summary';
                    const summary = calculateDateSummary(transactions);
                    dateSummary.innerHTML = `
                        <span class="expense">-¥${summary.expense.toFixed(2)}</span>
                        <span class="income">+¥${summary.income.toFixed(2)}</span>
                    `;
                    
                    dateHeader.appendChild(dateTitle);
                    dateHeader.appendChild(dateSummary);
                    dateGroup.appendChild(dateHeader);
                    
                    transactions.forEach(transaction => {
                        const transactionItem = createTransactionElement(transaction);
                        dateGroup.appendChild(transactionItem);
                    });
                    
                    fragment.appendChild(dateGroup);
                });
                
                // 将片段添加到DOM中
                transactionList.appendChild(fragment);

                // 移除现有的"加载更多"按钮（如果存在）
                const existingLoadMore = document.getElementById('loadMoreTransactions');
                if (existingLoadMore) existingLoadMore.remove();
                
                // 如果还有更多数据，添加"加载更多"按钮
                if (hasMoreData) {
                    const loadMoreContainer = document.createElement('div');
                    loadMoreContainer.id = 'loadMoreTransactions';
                    loadMoreContainer.style.cssText = `
                        display: flex;
                        justify-content: center;
                        padding: 15px 0;
                        color: #666;
                        font-size: 14px;
                        cursor: pointer;
                    `;
                    loadMoreContainer.innerHTML = `
                        <div>
                            <i class="fas fa-sync-alt" style="margin-right: 5px;"></i>加载更多
                        </div>
                    `;
                    loadMoreContainer.addEventListener('click', () => {
                        // 显示加载中状态
                        loadMoreContainer.innerHTML = '<div><i class="fas fa-spinner fa-spin" style="margin-right: 5px;"></i>加载中...</div>';
                        // 延迟一点加载，提供更好的用户体验
                        setTimeout(() => {
                            updateTransactionList(page + 1);
                        }, 300);
                    });
                    transactionList.appendChild(loadMoreContainer);
                } else if (page > 1) {
                    // 显示已加载全部的提示
                    const endTip = document.createElement('div');
                    endTip.id = 'endOfTransactionsTip';
                    endTip.style.cssText = `
                        text-align: center;
                        padding: 15px 0;
                        color: #999;
                        font-size: 12px;
                    `;
                    endTip.textContent = '- 已显示全部内容 -';
                    transactionList.appendChild(endTip);
                }
                
                // 添加触底自动加载功能
                if (page === 1 && hasMoreData) {
                    // 只在第一页添加滚动监听
                    const accountSection = document.querySelector('.account-section');
                    if (accountSection) {
                        // 移除已存在的滚动监听
                        accountSection.removeEventListener('scroll', window.transactionScrollHandler);
                        
                        // 创建新的滚动监听
                        window.transactionScrollHandler = function() {
                            const loadMoreBtn = document.getElementById('loadMoreTransactions');
                            if (!loadMoreBtn) return;
                            
                            const rect = loadMoreBtn.getBoundingClientRect();
                            if (rect.top <= window.innerHeight + 100) { // 提前100px开始加载
                                loadMoreBtn.click();
                            }
                        };
                        
                        accountSection.addEventListener('scroll', window.transactionScrollHandler);
                    }
                }
            } catch (error) {
                console.error('Error updating transaction list:', error);
                showToast('更新列表失败，请重试');
            }
        }

        function updateSummary() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const todayBills = DataStore.bills.filter(bill => bill.date === today);
                
                const summary = calculateDateSummary(todayBills);
                
                const incomeElement = document.querySelector('.summary-value.income');
                const expenseElement = document.querySelector('.summary-value.expense');
                const balanceElement = document.querySelector('.summary-row:last-child .summary-value');
                
                if (incomeElement) incomeElement.textContent = `+ ¥${summary.income.toFixed(2)}`;
                if (expenseElement) expenseElement.textContent = `- ¥${summary.expense.toFixed(2)}`;
                if (balanceElement) balanceElement.textContent = `¥${(summary.income - summary.expense).toFixed(2)}`;
            } catch (error) {
                console.error('Error updating summary:', error);
            }
        }

        function updateBudgetList() {
            try {
                const budgetList = document.querySelector('.category-budget-list');
                if (!budgetList) return;

                // 更新月度总预算
                const monthlyBudget = document.getElementById('monthlyBudget');
                if (monthlyBudget) {
                    monthlyBudget.value = DataStore.budgets.monthly;
                }

                // 更新分类预算
                Object.entries(DataStore.budgets.categories).forEach(([category, amount]) => {
                    const categoryItem = budgetList.querySelector(`[data-category="${category}"]`);
                    if (categoryItem) {
                        const input = categoryItem.querySelector('.category-budget-input');
                        if (input) {
                            input.value = amount;
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating budget list:', error);
            }
        }

        // 辅助函数
        function groupTransactionsByDate(transactions) {
            return transactions.reduce((groups, transaction) => {
                const date = new Date(transaction.date).toISOString().split('T')[0];
                if (!groups[date]) {
                    groups[date] = [];
                }
                groups[date].push(transaction);
                return groups;
            }, {});
        }

        function calculateDateSummary(transactions) {
            return transactions.reduce((summary, transaction) => {
                if (transaction.type === 'expense') {
                    summary.expense += transaction.amount;
                } else {
                    summary.income += transaction.amount;
                }
                return summary;
            }, { expense: 0, income: 0 });
        }

        function createTransactionElement(transaction) {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.setAttribute('data-id', transaction.id);
            
            const category = DataStore.categories[transaction.type].find(c => c.id === transaction.category);
            
            div.innerHTML = `
                <div class="transaction-content">
                    <div class="transaction-info">
                        <div class="category-icon">
                            <i class="fas ${category?.icon || 'fa-question'}"></i>
                        </div>
                        <div class="transaction-details">
                            <div class="transaction-title">${category?.name || '未分类'}</div>
                            <div class="transaction-date" data-date="${transaction.date}" data-time="${transaction.time || ''}">${transaction.time || formatTime(transaction.date)}</div>
                        </div>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'expense' ? '-' : '+'}¥${transaction.amount.toFixed(2)}
                    </div>
                </div>
                <div class="delete-action">
                    <i class="fas fa-trash"></i>
                </div>
            `;
            
            // 添加触摸和鼠标滑动事件
            let startX = 0;
            let currentX = 0;
            let isSwiping = false;
            
            // 触摸事件
            div.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isSwiping = true;
            });
            
            div.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;
                
                currentX = e.touches[0].clientX;
                const diff = currentX - startX;
                
                if (diff < 0) { // 只允许向左滑动
                    div.classList.add('swiping');
                }
            });
            
            div.addEventListener('touchend', () => {
                isSwiping = false;
                if (currentX - startX < -50) { // 如果滑动距离超过50px
                    div.classList.add('swiping');
                } else {
                    div.classList.remove('swiping');
                }
            });

            // 鼠标事件
            div.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                isSwiping = true;
            });

            div.addEventListener('mousemove', (e) => {
                if (!isSwiping) return;
                
                currentX = e.clientX;
                const diff = currentX - startX;
                
                if (diff < 0) { // 只允许向左滑动
                    div.classList.add('swiping');
                }
            });

            div.addEventListener('mouseup', () => {
                isSwiping = false;
                if (currentX - startX < -50) { // 如果滑动距离超过50px
                    div.classList.add('swiping');
                } else {
                    div.classList.remove('swiping');
                }
            });

            div.addEventListener('mouseleave', () => {
                if (isSwiping) {
                    isSwiping = false;
                    if (currentX - startX < -50) {
                        div.classList.add('swiping');
                    } else {
                        div.classList.remove('swiping');
                    }
                }
            });
            
            // 添加删除功能
            const deleteAction = div.querySelector('.delete-action');
            deleteAction.addEventListener('click', () => {
                // 直接删除账单，不需要二次确认
                // 删除账单
                DataStore.bills = DataStore.bills.filter(bill => bill.id !== transaction.id);
                DataStore.saveData();
                
                // 获取当前日期组
                const dateGroup = div.closest('.bills-date-group');
                if (dateGroup) {
                    // 删除当前交易项
                    div.remove();
                    
                    // 获取该日期组中剩余的交易项
                    const remainingTransactions = dateGroup.querySelectorAll('.transaction-item');
                    
                    // 如果该日期组没有剩余交易项，删除整个日期组
                    if (remainingTransactions.length === 0) {
                        dateGroup.remove();
                    } else {
                        // 更新日期组的汇总信息
                        const dateHeader = dateGroup.querySelector('.date-header');
                        if (dateHeader) {
                            const dateSummary = dateHeader.querySelector('.date-summary');
                            if (dateSummary) {
                                // 计算剩余交易项的汇总
                                const summary = calculateDateSummary(
                                    Array.from(remainingTransactions).map(item => {
                                        const id = item.getAttribute('data-id');
                                        return DataStore.bills.find(bill => bill.id === parseInt(id));
                                    }).filter(Boolean)
                                );
                                
                                dateSummary.innerHTML = `
                                    <span class="expense">-¥${summary.expense.toFixed(2)}</span>
                                    <span class="income">+¥${summary.income.toFixed(2)}</span>
                                `;
                            }
                        }
                    }
                }
                
                // 更新预算和摘要
                updateBudgetDisplay();
                updateSummary();
                
                // 显示删除成功的提示
                showToast('删除成功');
            });
            
            return div;
        }

        // 日期格式化函数
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                const now = new Date();
                
                // 获取年月日
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                // 今天
                if (date.toDateString() === now.toDateString()) {
                    return '今天';
                }
                
                // 昨天
                const yesterday = new Date(now);
                yesterday.setDate(now.getDate() - 1);
                if (date.toDateString() === yesterday.toDateString()) {
                    return '昨天';
                }
                
                // 本周内其他日期
                const dayNames = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
                const daysDiff = Math.round((now - date) / (1000 * 60 * 60 * 24));
                if (daysDiff < 7) {
                    return dayNames[date.getDay()];
                }
                
                // 超过一周但在今年内
                if (year === now.getFullYear()) {
                    return `${month}月${day}日`;
                }
                
                // 不是今年
                return `${year}年${month}月${day}日`;
            } catch (e) {
                console.error('Error formatting date:', e);
                return dateStr; // 返回原始日期字符串
            }
        }
        
        // 时间格式化函数
        function formatTime(dateStr) {
            try {
                const date = new Date(dateStr);
                const now = new Date();
                const hours = date.getHours();
                const minutes = date.getMinutes();
                
                // 格式化为12小时制
                const ampm = hours >= 12 ? '下午' : '上午';
                const hour12 = hours % 12 || 12;
                const minuteStr = minutes < 10 ? `0${minutes}` : minutes;

                // 如果是今天的日期，只显示时间
                if (date.toDateString() === now.toDateString()) {
                    return `${ampm} ${hour12}:${minuteStr}`;
                }
                
                // 如果是昨天的日期，显示昨天+时间
                const yesterday = new Date(now);
                yesterday.setDate(now.getDate() - 1);
                if (date.toDateString() === yesterday.toDateString()) {
                    return `昨天 ${ampm} ${hour12}:${minuteStr}`;
                }
                
                // 如果是本周的日期，显示周几+时间
                const dayNames = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
                const daysDiff = Math.round((now - date) / (1000 * 60 * 60 * 24));
                if (daysDiff < 7) {
                    return `${dayNames[date.getDay()]} ${ampm} ${hour12}:${minuteStr}`;
                }
                
                // 其他日期显示完整日期和时间
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const year = date.getFullYear();
                
                if (year === now.getFullYear()) {
                    return `${month}月${day}日 ${ampm} ${hour12}:${minuteStr}`;
                } else {
                    return `${year}年${month}月${day}日 ${ampm} ${hour12}:${minuteStr}`;
                }
            } catch (e) {
                console.error('Error formatting time:', e);
                return ''; // 出错时返回空字符串
            }
        }

        // 添加预算管理相关函数
        function updateBudgetDisplay() {
            const monthlyBudget = DataStore.budgets.monthly;
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            // 计算本月支出
            const monthlyExpenses = DataStore.bills
                .filter(bill => {
                    const billDate = new Date(bill.date);
                    return bill.type === 'expense' && 
                           billDate.getMonth() === currentMonth && 
                           billDate.getFullYear() === currentYear;
                })
                .reduce((sum, bill) => sum + bill.amount, 0);
            
            // 更新预算显示
            const budgetProgressBar = document.getElementById('budgetProgressBar');
            const budgetUsed = document.getElementById('budgetUsed');
            const budgetRemaining = document.getElementById('budgetRemaining');
            
            if (monthlyBudget > 0) {
                const progress = Math.min((monthlyExpenses / monthlyBudget) * 100, 100);
                budgetProgressBar.style.width = `${progress}%`;
                budgetUsed.textContent = `¥${monthlyExpenses.toFixed(2)}`;
                budgetRemaining.textContent = `¥${(monthlyBudget - monthlyExpenses).toFixed(2)}`;
                
                // 根据使用情况改变进度条颜色
                if (progress >= 90) {
                    budgetProgressBar.style.background = 'linear-gradient(to right, #ff416c, #ff4b2b)';
                } else if (progress >= 70) {
                    budgetProgressBar.style.background = 'linear-gradient(to right, #ff9a9e, #fad0c4)';
                } else {
                    budgetProgressBar.style.background = 'linear-gradient(to right, #36d1dc, #5b86e5)';
                }
            } else {
                budgetProgressBar.style.width = '0%';
                budgetUsed.textContent = '¥0.00';
                budgetRemaining.textContent = '¥0.00';
            }
        }

        // 在页面加载完成后初始化预算显示
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing initialization code ...
            
            // 初始化预算显示
            updateBudgetDisplay();
            
            // 添加预算编辑按钮事件
            const editBudgetBtn = document.getElementById('editBudget');
            if (editBudgetBtn) {
                editBudgetBtn.addEventListener('click', function() {
                    showModal(document.getElementById('budgetModal'));
                });
            }
            
            // 在保存预算时更新显示
            const budgetSaveBtn = document.getElementById('saveBudget');
            if (budgetSaveBtn) {
                budgetSaveBtn.addEventListener('click', function() {
                    const monthlyBudget = parseFloat(document.getElementById('monthlyBudget').value);
                    DataStore.budgets.monthly = monthlyBudget;
                    DataStore.saveData();
                    hideModal(document.getElementById('budgetModal'));
                    updateBudgetDisplay();
                });
            }

            // 如果当前在统计页面，立即更新统计
            if (document.getElementById('statisticsPage').classList.contains('active')) {
                console.log('Initial statistics update...'); // 添加调试日志
                updateStatistics('日');
            }
        });

        // 处理账单表单提交
        const billForm = document.getElementById('billForm');
        if (billForm) {
          billForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const bill = {
                id: Date.now(),
                type: document.getElementById('billType').value,
                category: document.getElementById('billCategory').value,
                amount: parseFloat(document.getElementById('billAmount').value),
                date: document.getElementById('billDate').value,
                time: new Date().toLocaleTimeString('zh-CN', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }), // 修改时间格式
                note: document.getElementById('billNote').value
            };
            
            DataStore.bills.push(bill);
            DataStore.saveData();
            
            // 更新所有相关页面
            updateBillsList();
            updateSummary();
            
            // 重置表单
            this.reset();
            
            // 关闭模态框
            const modal = bootstrap.Modal.getInstance(document.getElementById('addBillModal'));
            modal.hide();
            
            // 显示成功提示
            showToast('添加成功', 'success');
          });
        }

        // 统计相关函数
        function updateStatistics(period = '日') {
            const stats = calculateStatistics(period);
            updateStatsSummary(stats);
            updateStatsChart(stats);
            updateCategoryStats(stats);
        }

        function calculateStatistics(period) {
            const now = new Date();
            let startDate, endDate;
            
            switch(period) {
                case '日':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
                    break;
                case '周':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay());
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                case '月':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case '年':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31);
                    break;
            }

            const filteredBills = DataStore.bills.filter(bill => {
                const billDate = new Date(bill.date);
                return billDate >= startDate && billDate <= endDate;
            });

            const expenseBills = filteredBills.filter(bill => bill.type === 'expense');
            const incomeBills = filteredBills.filter(bill => bill.type === 'income');

            const totalExpense = expenseBills.reduce((sum, bill) => sum + bill.amount, 0);
            const totalIncome = incomeBills.reduce((sum, bill) => sum + bill.amount, 0);

            // 计算分类统计
            const categoryStats = calculateCategoryStats(expenseBills);

            return {
                totalExpense,
                totalIncome,
                expenseChange: 0,
                incomeChange: 0,
                categoryStats,
                trendData: { labels: [], data: [] }
            };
        }

        function calculateCategoryStats(bills) {
            if (bills.length === 0) return [];

            const categoryExpenses = bills.reduce((stats, bill) => {
                if (!stats[bill.category]) {
                    stats[bill.category] = 0;
                }
                stats[bill.category] += bill.amount;
                return stats;
            }, {});

            const totalExpense = Object.values(categoryExpenses).reduce((sum, amount) => sum + amount, 0);

            return Object.entries(categoryExpenses).map(([category, amount]) => ({
                category,
                amount,
                percentage: (amount / totalExpense) * 100
            })).sort((a, b) => b.amount - a.amount);
        }

        function updateStatsSummary(stats) {
            const summaryCards = document.querySelectorAll('.stats-card');
            if (summaryCards.length >= 2) {
                summaryCards[0].querySelector('.stats-card-value').textContent = `¥${stats.totalExpense.toFixed(2)}`;
                summaryCards[1].querySelector('.stats-card-value').textContent = `¥${stats.totalIncome.toFixed(2)}`;
            }
        }

        function updateStatsChart(stats) {
            try {
                // 获取当前选中的时间周期
                const activePeriod = document.querySelector('.period-option.active')?.textContent || '日';
                
                // 移除旧的图表占位符
                const chartContainer = document.querySelector('.chart-placeholder');
                if (chartContainer) {
                    chartContainer.innerHTML = '';
                }
                
                // 准备趋势数据
                const now = new Date();
                let labels = [];
                let data = [];
                
                switch(activePeriod) {
                    case '日':
                        // 显示一天内的24小时
                        for (let i = 0; i < 24; i++) {
                            labels.push(`${i}时`);
                            // 筛选特定小时的账单
                            const hourlyExpense = DataStore.bills
                                .filter(bill => {
                                    const billDate = new Date(bill.date);
                                    return bill.type === 'expense' && 
                                           billDate.getDate() === now.getDate() &&
                                           billDate.getMonth() === now.getMonth() &&
                                           billDate.getFullYear() === now.getFullYear() &&
                                           (bill.timestamp ? new Date(bill.timestamp).getHours() === i : false);
                                })
                                .reduce((sum, bill) => sum + bill.amount, 0);
                            data.push(hourlyExpense);
                        }
                        break;
                    
                    case '周':
                        // 显示本周的7天
                        const dayNames = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
                        const today = now.getDay(); // 0是周日，6是周六
                        
                        for (let i = 0; i < 7; i++) {
                            labels.push(dayNames[i]);
                            
                            const targetDate = new Date(now);
                            // 计算与目标日期的差值
                            const diff = i - today;
                            targetDate.setDate(now.getDate() + diff);
                            
                            const dailyExpense = DataStore.bills
                                .filter(bill => {
                                    const billDate = new Date(bill.date);
                                    return bill.type === 'expense' && 
                                           billDate.getDate() === targetDate.getDate() &&
                                           billDate.getMonth() === targetDate.getMonth() &&
                                           billDate.getFullYear() === targetDate.getFullYear();
                                })
                                .reduce((sum, bill) => sum + bill.amount, 0);
                            data.push(dailyExpense);
                        }
                        break;
                    
                    case '月':
                        // 显示本月的所有天
                        const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                        
                        for (let i = 1; i <= daysInMonth; i++) {
                            labels.push(`${i}日`);
                            
                            const dailyExpense = DataStore.bills
                                .filter(bill => {
                                    const billDate = new Date(bill.date);
                                    return bill.type === 'expense' && 
                                           billDate.getDate() === i &&
                                           billDate.getMonth() === now.getMonth() &&
                                           billDate.getFullYear() === now.getFullYear();
                                })
                                .reduce((sum, bill) => sum + bill.amount, 0);
                            data.push(dailyExpense);
                        }
                        break;
                    
                    case '年':
                        // 显示今年的12个月
                        const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
                        
                        for (let i = 0; i < 12; i++) {
                            labels.push(monthNames[i]);
                            
                            const monthlyExpense = DataStore.bills
                                .filter(bill => {
                                    const billDate = new Date(bill.date);
                                    return bill.type === 'expense' && 
                                           billDate.getMonth() === i &&
                                           billDate.getFullYear() === now.getFullYear();
                                })
                                .reduce((sum, bill) => sum + bill.amount, 0);
                            data.push(monthlyExpense);
                        }
                        break;
                }
                
                // 创建可视化图表
                if (chartContainer) {
                    // 找出最大值以计算百分比高度
                    const maxValue = Math.max(...data, 0.01); // 避免除以0
                    
                    // 计算索引范围以显示最近的数据
                    let startIndex = 0;
                    let endIndex = labels.length;
                    
                    // 对于月和年，可能需要限制显示的条目数量
                    if (activePeriod === '月' && labels.length > 10) {
                        endIndex = now.getDate();
                        startIndex = Math.max(0, endIndex - 10);
                    }
                    
                    // 生成柱状图
                    for (let i = startIndex; i < endIndex; i++) {
                        const height = Math.max((data[i] / maxValue) * 100, 5); // 至少5%高度以便可见
                        const isActive = (activePeriod === '日' && i === now.getHours()) ||
                                        (activePeriod === '周' && i === now.getDay()) ||
                                        (activePeriod === '月' && i === now.getDate() - 1) ||
                                        (activePeriod === '年' && i === now.getMonth());
                        
                        const bar = document.createElement('div');
                        bar.className = `chart-bar ${isActive ? 'active' : ''}`;
                        bar.style.height = `${height}%`;
                        
                        const label = document.createElement('span');
                        label.textContent = labels[i];
                        bar.appendChild(label);
                        
                        // 添加工具提示显示具体金额
                        bar.title = `¥${data[i].toFixed(2)}`;
                        
                        chartContainer.appendChild(bar);
                    }
                }
                
                console.log('Chart updated for period:', activePeriod);
            } catch (error) {
                console.error('Error updating stats chart:', error);
            }
        }

        function updateCategoryStats(stats) {
            const categoryStatsContainer = document.querySelector('.category-stats');
            if (!categoryStatsContainer) return;

            // 更新分类列表
            if (!stats.categoryStats || stats.categoryStats.length === 0) {
                categoryStatsContainer.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-chart-pie" style="font-size: 48px; color: #ccc; margin-bottom: 10px;"></i>
                        <p>暂无分类数据</p>
                    </div>`;
                return;
            }

            categoryStatsContainer.innerHTML = stats.categoryStats.map(stat => `
                <div class="category-stat-item">
                    <div class="category-stat-info">
                        <div class="category-stat-icon">
                            <i class="fas ${getCategoryIcon(stat.category)}"></i>
                        </div>
                        <div>
                            <div class="category-stat-name">${getCategoryName(stat.category)}</div>
                            <div class="category-stat-percent">${stat.percentage.toFixed(1)}%</div>
                        </div>
                    </div>
                    <div class="category-stat-amount">¥${stat.amount.toFixed(2)}</div>
                </div>
            `).join('');

            // 更新饼图
            const ctx = document.getElementById('expensePieChart');
            if (!ctx) {
                console.error('Canvas element for pie chart not found');
                return;
            }

            try {
                console.log('Updating pie chart with data:', stats.categoryStats);
                
                // 如果已存在图表实例，先销毁它
                if (window.expensePieChart) {
                    try {
                        if (typeof window.expensePieChart.destroy === 'function') {
                            window.expensePieChart.destroy();
                        }
                    } catch (e) {
                        console.error('Error destroying existing chart:', e);
                        // 忽略错误，继续创建新图表
                    }
                }

                // 准备饼图数据 - 只取前5名，其余归类为"其他"
                let pieData = [...stats.categoryStats];
                let otherCategories = {
                    category: 'others',
                    amount: 0,
                    percentage: 0
                };

                if (pieData.length > 5) {
                    otherCategories.amount = pieData.slice(5).reduce((sum, item) => sum + item.amount, 0);
                    otherCategories.percentage = pieData.slice(5).reduce((sum, item) => sum + item.percentage, 0);
                    pieData = pieData.slice(0, 5);
                    pieData.push(otherCategories);
                }

                const labels = pieData.map(stat => stat.category === 'others' ? '其他' : getCategoryName(stat.category));
                const data = pieData.map(stat => stat.amount);
                const backgroundColors = [
                    '#4a90e2', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6',
                    '#34495e' // 其他类别的颜色
                ];

                console.log('Creating pie chart with labels:', labels);
                console.log('Data values:', data);

                // 确保Chart.js已加载
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not loaded');
                    return;
                }

                // 确保ChartDataLabels插件已加载
                if (typeof ChartDataLabels === 'undefined') {
                    console.warn('ChartDataLabels plugin is not loaded, proceeding without data labels');
                }

                const plugins = [];
                if (typeof ChartDataLabels !== 'undefined') {
                    plugins.push(ChartDataLabels);
                }

                // 创建饼图
                window.expensePieChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const percentage = (value / data.reduce((a, b) => a + b, 0)) * 100;
                                        return `${label}: ¥${value.toFixed(2)} (${percentage.toFixed(1)}%)`;
                                    }
                                }
                            },
                            datalabels: typeof ChartDataLabels !== 'undefined' ? {
                                color: '#fff',
                                font: { weight: 'bold', size: 13 },
                                formatter: function(value, context) {
                                    const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    const percent = total ? value / total * 100 : 0;
                                    return percent > 3 ? percent.toFixed(1) + '%' : '';
                                }
                            } : false
                        }
                    },
                    plugins: plugins
                });

                console.log('Pie chart created successfully');
                
                // 绑定点击事件
                bindCategoryStatClick();
            } catch (error) {
                console.error('Error creating pie chart:', error);
            }
        }

        // 初始化统计页面
        const periodOptions = document.querySelectorAll('.period-option');
        periodOptions.forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.period-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                updateStatistics(this.textContent);
            });
        });

        // 分类图标和名称辅助函数
        function getCategoryIcon(categoryId) {
            const category = [
                ...(DataStore.categories.income || []),
                ...(DataStore.categories.expense || [])
            ].find(cat => cat.id === categoryId);
            return category ? category.icon : 'fa-question';
        }

        function getCategoryName(categoryId) {
            const category = [
                ...(DataStore.categories.income || []),
                ...(DataStore.categories.expense || [])
            ].find(cat => cat.id === categoryId);
            return category ? category.name : '其他';
        }

        function showCategoryDetailModal(categoryId) {
            // 获取该分类下所有支出账单
            const bills = DataStore.bills.filter(bill => bill.type === 'expense' && bill.category === categoryId);
            const modal = document.getElementById('categoryDetailModal');
            const title = document.getElementById('categoryDetailTitle');
            const body = document.getElementById('categoryDetailBody');
            title.textContent = getCategoryName(categoryId) + '明细';
            if (bills.length === 0) {
                body.innerHTML = '<div class="no-data"><i class="fas fa-receipt" style="font-size:36px;color:#ccc;"></i><div>暂无该分类的消费记录</div></div>';
            } else {
                body.innerHTML = bills.map(bill => `
                    <div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.05);padding:15px;margin-bottom:15px;">
                        <div style="font-size:16px;font-weight:500;color:#e74c3c;">-¥${bill.amount.toFixed(2)}</div>
                        <div style="font-size:13px;color:#666;margin:6px 0 2px;">${bill.date}</div>
                        <div style="font-size:13px;color:#999;">${bill.note ? '备注：' + bill.note : ''}</div>
                    </div>
                `).join('');
            }
            showModal(modal);
        }

        // 绑定支出分类点击事件（在updateCategoryStats后调用）
        function bindCategoryStatClick() {
            document.querySelectorAll('.category-stat-item').forEach(item => {
                item.onclick = function() {
                    const nameDiv = this.querySelector('.category-stat-name');
                    if (!nameDiv) return;
                    const categoryName = nameDiv.textContent;
                    // 通过名称查id
                    const cat = [...(DataStore.categories.expense||[]), ...(DataStore.categories.income||[])]
                        .find(c => c.name === categoryName);
                    if (cat) showCategoryDetailModal(cat.id);
                };
            });
        }
    


        // 重写 updateBillsListByDate，支持类型筛选
        function updateBillsListByDate(date) {
            try {
                console.log('Updating bills list by date:', date);
                const year = date.getFullYear();
                const month = date.getMonth();
                const startDate = new Date(year, month, 1);
                const endDate = new Date(year, month + 1, 0);
                
                // 更新日期显示
                const dateFilterText = document.getElementById('currentFilterDate');
                if (dateFilterText) {
                    dateFilterText.textContent = `${year}年${month + 1}月`;
                }
                
                // 获取当前选中的筛选类型
                const activeFilterType = document.querySelector('.type-filter-item.active')?.getAttribute('data-type') || '全部';
                
                let filteredBills = DataStore.bills.filter(bill => {
                    const billDate = new Date(bill.date);
                    return billDate >= startDate && billDate <= endDate;
                });
                
                if (activeFilterType !== '全部') {
                    filteredBills = filteredBills.filter(bill => bill.type === activeFilterType.toLowerCase());
                }
                
                const billsList = document.querySelector('.bills-list');
                if (!billsList) {
                    console.error('Bills list element not found');
                    return;
                }
                
                billsList.innerHTML = '';
                if (filteredBills.length === 0) {
                    billsList.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-receipt" style="font-size: 48px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>该月暂无账单记录</p>
                        </div>`;
                    return;
                }
                
                // 按日期倒序排序
                filteredBills.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const groupedBills = groupTransactionsByDate(filteredBills);
                const sortedDates = Object.keys(groupedBills).sort((a, b) => new Date(b) - new Date(a));
                
                sortedDates.forEach(date => {
                    const transactions = groupedBills[date];
                    const dateGroup = document.createElement('div');
                    dateGroup.className = 'bills-date-group';
                    
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-header';
                    
                    const dateTitle = document.createElement('div');
                    dateTitle.className = 'date-title';
                    dateTitle.textContent = formatDate(date);
                    
                    const dateSummary = document.createElement('div');
                    dateSummary.className = 'date-summary';
                    const summary = calculateDateSummary(transactions);
                    dateSummary.innerHTML = `
                        <span class="expense">-¥${summary.expense.toFixed(2)}</span>
                        <span class="income">+¥${summary.income.toFixed(2)}</span>
                    `;
                    
                    dateHeader.appendChild(dateTitle);
                    dateHeader.appendChild(dateSummary);
                    dateGroup.appendChild(dateHeader);
                    
                    transactions.forEach(transaction => {
                        const transactionItem = createTransactionElement(transaction);
                        dateGroup.appendChild(transactionItem);
                    });
                    
                    billsList.appendChild(dateGroup);
                });

                console.log('Bills list by date updated successfully');
            } catch (error) {
                console.error('Error updating bills list by date:', error);
            }
        }

      

        const billsDateFilter = document.getElementById('billsDateFilter');
        if (billsDateFilter) {
            billsDateFilter.addEventListener('click', function() {
                const now = new Date();
                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth();
                
                let selectedYear = currentYear;
                let selectedMonth = currentMonth;
                const dateText = billsDateFilter.querySelector('span').textContent;
                const match = dateText.match(/(\d+)年(\d+)月/);
                if (match) {
                    selectedYear = parseInt(match[1]);
                    selectedMonth = parseInt(match[2]) - 1;
                }
                
                const datePicker = document.createElement('div');
                datePicker.className = 'modal';
                datePicker.id = 'datePickerModal';
                datePicker.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>选择月份</h2>
                            <span class="close-modal">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="month-selector">
                                <div class="month-arrow" id="prevMonth"><i class="fas fa-chevron-left"></i></div>
                                <div class="month-title" id="currentMonthTitle">${selectedYear}年${selectedMonth + 1}月</div>
                                <div class="month-arrow" id="nextMonth"><i class="fas fa-chevron-right"></i></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-cancel" id="cancelMonthSelect">取消</button>
                            <button class="btn btn-save" id="confirmMonthSelect">确定</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(datePicker);
                showModal(datePicker);
                
                function updateMonthDisplay(year, month) {
                    datePicker.querySelector('#currentMonthTitle').textContent = `${year}年${month + 1}月`;
                    
                    // 禁用/启用下一月按钮
                    const nextMonthBtn = datePicker.querySelector('#nextMonth');
                    if (year >= currentYear && month >= currentMonth) {
                        nextMonthBtn.style.opacity = '0.5';
                        nextMonthBtn.style.pointerEvents = 'none';
                    } else {
                        nextMonthBtn.style.opacity = '1';
                        nextMonthBtn.style.pointerEvents = 'auto';
                    }
                }
                
                updateMonthDisplay(selectedYear, selectedMonth);
                
                datePicker.querySelector('#prevMonth').addEventListener('click', function() {
                    selectedMonth--;
                    if (selectedMonth < 0) {
                        selectedMonth = 11;
                        selectedYear--;
                    }
                    updateMonthDisplay(selectedYear, selectedMonth);
                });
                
                datePicker.querySelector('#nextMonth').addEventListener('click', function() {
                    // 不允许选择超过当前月份的日期
                    if (selectedYear >= currentYear && selectedMonth >= currentMonth) {
                        return;
                    }
                    
                    selectedMonth++;
                    if (selectedMonth > 11) {
                        selectedMonth = 0;
                        selectedYear++;
                    }
                    updateMonthDisplay(selectedYear, selectedMonth);
                });
                
                datePicker.querySelector('#confirmMonthSelect').addEventListener('click', function() {
                    const selectedDate = new Date(selectedYear, selectedMonth, 1);
                    const dateFilterText = billsDateFilter.querySelector('span');
                    if (dateFilterText) {
                        dateFilterText.textContent = `${selectedYear}年${selectedMonth + 1}月`;
                    }
                    updateBillsListByDate(selectedDate);
                    hideModal(datePicker);
                    setTimeout(() => {
                        datePicker.remove();
                    }, 300);
                });
                
                datePicker.querySelector('#cancelMonthSelect').addEventListener('click', function() {
                    hideModal(datePicker);
                    setTimeout(() => {
                        datePicker.remove();
                    }, 300);
                });
                
                datePicker.querySelector('.close-modal').addEventListener('click', function() {
                    hideModal(datePicker);
                    setTimeout(() => {
                        datePicker.remove();
                    }, 300);
                });
                
                // 点击模态窗口外部关闭
                datePicker.addEventListener('click', function(e) {
                    if (e.target === datePicker) {
                        hideModal(datePicker);
                        setTimeout(() => {
                            datePicker.remove();
                        }, 300);
                    }
                });
            });
        }

        // 修改账单页面的列表显示
        function updateBillsList(filter) {
            try {
                console.log('Updating bills list, filter:', filter);
                const billsList = document.querySelector('.bills-list');
                if (!billsList) {
                    console.error('Bills list element not found');
                    return;
                }

                // 获取当前选中的筛选类型
                const activeFilter = filter || document.querySelector('.type-filter-item.active')?.getAttribute('data-type') || '全部';
                console.log('Active filter:', activeFilter);

                let filteredBills = DataStore.bills;
                if (activeFilter !== '全部') {
                    filteredBills = DataStore.bills.filter(bill => bill.type === activeFilter.toLowerCase());
                }

                // 按日期倒序排序
                filteredBills.sort((a, b) => new Date(b.date) - new Date(a.date));

                billsList.innerHTML = '';
                if (filteredBills.length === 0) {
                    billsList.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-receipt" style="font-size: 48px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>暂无账单记录</p>
                            <p style="font-size: 12px; color: #999; margin-top: 5px;">点击右下角"+"添加新账单</p>
                        </div>`;
                    return;
                }

                const groupedBills = groupTransactionsByDate(filteredBills);
                const sortedDates = Object.keys(groupedBills).sort((a, b) => new Date(b) - new Date(a));

                sortedDates.forEach(date => {
                    const transactions = groupedBills[date];
                    const dateGroup = document.createElement('div');
                    dateGroup.className = 'bills-date-group';
                    
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-header';
                    
                    const dateTitle = document.createElement('div');
                    dateTitle.className = 'date-title';
                    dateTitle.textContent = formatDate(date);
                    
                    const dateSummary = document.createElement('div');
                    dateSummary.className = 'date-summary';
                    const summary = calculateDateSummary(transactions);
                    dateSummary.innerHTML = `
                        <span class="expense">-¥${summary.expense.toFixed(2)}</span>
                        <span class="income">+¥${summary.income.toFixed(2)}</span>
                    `;
                    
                    dateHeader.appendChild(dateTitle);
                    dateHeader.appendChild(dateSummary);
                    dateGroup.appendChild(dateHeader);
                    
                    transactions.forEach(transaction => {
                        const transactionItem = createTransactionElement(transaction);
                        dateGroup.appendChild(transactionItem);
                    });
                    
                    billsList.appendChild(dateGroup);
                });

                console.log('Bills list updated successfully');
            } catch (error) {
                console.error('Error updating bills list:', error);
            }
        }

        // 账单页面 - 类型筛选切换
        document.querySelectorAll('.filter-option').forEach(option => {
            option.addEventListener('click', function() {
                // 移除其他选项的激活状态
                document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                
                // 激活当前选项
                this.classList.add('active');
                
                // 获取当前筛选类型
                const filterType = this.textContent; // '全部', '支出', '收入'
                console.log('Filter type changed to:', filterType);
                
                // 更新账单统计数据
                updateBillsSummary(filterType);
                
                // 更新账单列表
                if (filterType === '全部') {
                    updateBillsList();
                } else {
                    const type = filterType === '支出' ? 'expense' : 'income';
                    updateBillsList(type);
                }
            });
        });
        
        // 更新账单页顶部统计数据
        function updateBillsSummary(filterType = '全部') {
            try {
                const billsSummary = document.querySelector('.bills-summary');
                if (!billsSummary) return;
                
                // 获取筛选日期
                let selectedDate = new Date();
                const dateFilterText = document.querySelector('#billsDateFilter span')?.textContent;
                if (dateFilterText) {
                    const match = dateFilterText.match(/(\d+)年(\d+)月/);
                    if (match) {
                        selectedDate = new Date(parseInt(match[1]), parseInt(match[2]) - 1, 1);
                    }
                }
                
                // 获取该月账单
                const year = selectedDate.getFullYear();
                const month = selectedDate.getMonth();
                const startDate = new Date(year, month, 1);
                const endDate = new Date(year, month + 1, 0);
                
                // 筛选该月账单
                let filteredBills = DataStore.bills.filter(bill => {
                    const billDate = new Date(bill.date);
                    return billDate >= startDate && billDate <= endDate;
                });
                
                // 计算统计数据
                const expenseBills = filteredBills.filter(bill => bill.type === 'expense');
                const incomeBills = filteredBills.filter(bill => bill.type === 'income');
                
                const totalExpense = expenseBills.reduce((sum, bill) => sum + bill.amount, 0);
                const totalIncome = incomeBills.reduce((sum, bill) => sum + bill.amount, 0);
                const balance = totalIncome - totalExpense;
                
                // 更新统计显示
                billsSummary.innerHTML = `
                    <div class="summary-row">
                        <span>收入</span>
                        <span class="income">¥${totalIncome.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>支出</span>
                        <span class="expense">¥${totalExpense.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>结余</span>
                        <span ${balance >= 0 ? 'class="income"' : 'class="expense"'}>¥${balance.toFixed(2)}</span>
                    </div>
                `;
                
                console.log('Bills summary updated successfully');
            } catch (error) {
                console.error('Error updating bills summary:', error);
            }
        }

        // 保存交易按钮事件
        const saveTransactionBtn = document.getElementById('saveTransaction');
        if (saveTransactionBtn) {
            saveTransactionBtn.addEventListener('click', function() {
                console.log('Save transaction button clicked');
                const amountInput = document.getElementById('amountInput');
                const activeTypeOption = document.querySelector('.type-selector .type-option.active');
                const activeCategoryItem = document.querySelector('.category-selector .category-item.active');
                const dateInput = document.getElementById('dateInput');
                const noteInput = document.getElementById('noteInput');

                if (!amountInput || !activeTypeOption || !activeCategoryItem || !dateInput) {
                    console.error('Required form elements not found');
                    alert('表单元素缺失，请刷新页面重试');
                    return;
                }

                const amount = parseFloat(amountInput.value);
                const type = activeTypeOption.getAttribute('data-type');
                const category = activeCategoryItem?.getAttribute('data-category');
                const date = dateInput.value;
                const note = noteInput ? noteInput.value : '';

                if (!amount || !category || !date) {
                    alert('请填写必要信息：金额、分类和日期');
                    return;
                }

                // 获取当前北京时间
                const now = new Date();
                // 北京时间比UTC快8小时
                const beijingTime = new Date(now.getTime() + 8 * 60 * 60 * 1000);
                const formattedTime = beijingTime.toISOString().substr(11, 8);
                
                const bill = {
                    id: Date.now(),
                    amount,
                    type,
                    category,
                    date,
                    note,
                    time: formattedTime,
                    timestamp: beijingTime.toISOString()
                };

                console.log('Adding bill:', bill);
                // 添加账单
                DataStore.addBill(bill);

                // 关闭模态窗口
                hideModal(document.getElementById('addTransactionModal'));

                // 清空表单
                amountInput.value = '';
                if (noteInput) noteInput.value = '';

                // 更新所有相关页面的数据
                // 首页数据
                updateTransactionList();
                updateSummary();
                updateBudgetDisplay();
                
                // 账单页数据
                updateBillsList();
                updateBillsSummary();
                
                // 统计页数据
                const activePeriod = document.querySelector('.period-option.active');
                if (activePeriod) {
                    updateStatistics(activePeriod.textContent);
                }
                
                // 个人中心数据
                updateProfileSummary();
                
                // 更新时间显示
                updateTransactionTimes();
                
                // 显示添加成功的提示
                showToast('添加成功!');
            });
        }
        
        // 简单的提示消息功能
        function showToast(message, duration = 2000) {
            // 检查是否已存在toast元素
            let toast = document.querySelector('.toast-message');
            if (!toast) {
                // 创建新的toast元素
                toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.7);
                    color: #fff;
                    padding: 10px 20px;
                    border-radius: 20px;
                    font-size: 14px;
                    z-index: 9999;
                    transition: opacity 0.3s, transform 0.3s;
                    opacity: 0;
                `;
                document.body.appendChild(toast);
            }
            
            // 设置消息并显示
            toast.textContent = message;
            // 重置可能已有的定时器
            clearTimeout(toast.timer);
            // 重置样式以应用过渡效果
            toast.style.opacity = '0';
            toast.style.transform = 'translate(-50%, 20px)';
            
            // 使用RAF确保DOM更新后再应用动画
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    toast.style.opacity = '1';
                    toast.style.transform = 'translate(-50%, 0)';
                });
            });
            
            // 设置自动隐藏
            toast.timer = setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, -20px)';
                // 动画完成后移除元素
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }

        // 添加个人中心菜单项点击事件
        function initProfilePageMenus() {
            try {
                // 云同步按钮
                const dataSyncBtn = document.getElementById('dataSync');
                if (dataSyncBtn) {
                    dataSyncBtn.addEventListener('click', function() {
                        console.log('Data sync clicked');
                        showToast('云同步功能正在开发中，敬请期待');
                    });
                }
                
                // 数据备份按钮
                const dataBackupBtn = document.getElementById('dataBackup');
                if (dataBackupBtn) {
                    dataBackupBtn.addEventListener('click', function() {
                        console.log('Data backup clicked');
                        backupData();
                    });
                }
                
                // 数据导入按钮
                const dataImportBtn = document.getElementById('dataImport');
                if (dataImportBtn) {
                    dataImportBtn.addEventListener('click', function() {
                        console.log('Data import clicked');
                        importData();
                    });
                }
                
                // 预算管理
                const budgetManagementBtn = document.getElementById('budgetManagement');
                if (budgetManagementBtn) {
                    budgetManagementBtn.addEventListener('click', function() {
                        console.log('Budget management clicked');
                        showModal(document.getElementById('budgetModal'));
                    });
                }

                // 消息通知
                const notificationsBtn = document.getElementById('notifications');
                if (notificationsBtn) {
                    notificationsBtn.addEventListener('click', function() {
                        console.log('Notifications clicked');
                        populateNotificationsModal();
                        showModal(document.getElementById('notificationsModal'));
                    });
                }

                // 设置
                const settingsBtn = document.getElementById('settings');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', function() {
                        console.log('Settings clicked');
                        populateSettingsModal();
                        showModal(document.getElementById('settingsModal'));
                    });
                }

                // 常见问题
                const commonQuestionsBtn = document.getElementById('commonQuestions');
                if (commonQuestionsBtn) {
                    commonQuestionsBtn.addEventListener('click', function() {
                        console.log('Common questions clicked');
                        populateCommonQuestionsModal();
                        showModal(document.getElementById('commonQuestionsModal'));
                    });
                }

                // 关于我们
                const aboutUsBtn = document.getElementById('aboutUs');
                if (aboutUsBtn) {
                    aboutUsBtn.addEventListener('click', function() {
                        console.log('About us clicked');
                        populateAboutModal();
                        showModal(document.getElementById('aboutModal'));
                    });
                }

                // 用户头像点击
                const profileAvatar = document.querySelector('.profile-avatar');
                if (profileAvatar) {
                    profileAvatar.addEventListener('click', function() {
                        console.log('Profile avatar clicked');
                        showAvatarEditModal();
                    });
                }

                console.log('Profile page menus initialized');
            } catch (error) {
                console.error('Error initializing profile page menus:', error);
            }
        }

        // 填充消息通知模态窗口内容
        function populateNotificationsModal() {
            try {
                const modalBody = document.querySelector('#notificationsModal .modal-body');
                if (!modalBody) return;

                // 创建消息通知列表
                const notifications = [
                    {
                        id: 1,
                        title: '预算提醒',
                        content: '您本月的餐饮预算已使用80%，请注意控制开支。',
                        time: '2023-06-01 08:30',
                        icon: 'fa-bell',
                        color: '#2ecc71',
                        read: false
                    },
                    {
                        id: 2,
                        title: '账单提醒',
                        content: '您有一笔¥328.50的账单已添加成功。',
                        time: '2023-05-30 14:15',
                        icon: 'fa-receipt',
                        color: '#3498db',
                        read: true
                    },
                    {
                        id: 3,
                        title: '系统通知',
                        content: '西瓜账本已更新到最新版本，体验全新功能。',
                        time: '2023-05-28 09:45',
                        icon: 'fa-info-circle',
                        color: '#e67e22',
                        read: true
                    }
                ];

                // 构建通知列表HTML
                let notificationsHTML = `
                    <div class="notification-actions">
                        <span class="notification-count">${notifications.length}条通知</span>
                        <button class="btn-mark-all">全部标为已读</button>
                    </div>
                    <div class="notification-list">
                `;

                notifications.forEach(notification => {
                    notificationsHTML += `
                        <div class="notification-item ${notification.read ? 'read' : ''}" data-id="${notification.id}">
                            <div class="notification-icon" style="background:${notification.color}20; color:${notification.color}">
                                <i class="fas ${notification.icon}"></i>
                            </div>
                            <div class="notification-info">
                                <div class="notification-title">${notification.title}</div>
                                <div class="notification-content">${notification.content}</div>
                                <div class="notification-time">${notification.time}</div>
                            </div>
                        </div>
                    `;
                });

                notificationsHTML += `</div>`;
                modalBody.innerHTML = notificationsHTML;

                // 添加标记已读事件
                modalBody.querySelectorAll('.notification-item').forEach(item => {
                    item.addEventListener('click', function() {
                        this.classList.add('read');
                    });
                });

                // 全部标为已读按钮
                const markAllBtn = modalBody.querySelector('.btn-mark-all');
                if (markAllBtn) {
                    markAllBtn.addEventListener('click', function() {
                        modalBody.querySelectorAll('.notification-item').forEach(item => {
                            item.classList.add('read');
                        });
                        showToast('已全部标为已读');
                    });
                }

                console.log('Notifications modal populated');
            } catch (error) {
                console.error('Error populating notifications modal:', error);
            }
        }

        // 填充设置模态窗口内容
        function populateSettingsModal() {
            try {
                const modalBody = document.querySelector('#settingsModal .modal-body');
                if (!modalBody) return;

                // 构建设置选项
                const settingsHTML = `
                    <div class="settings-list">
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background:#f0f7ff; color:#3498db;">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="settings-name">货币单位</div>
                            </div>
                            <div class="settings-value">人民币 (¥)</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background:#e8fff0; color:#2ecc71;">
                                    <i class="fas fa-language"></i>
                                </div>
                                <div class="settings-name">语言</div>
                            </div>
                            <div class="settings-value">
                                <select id="languageSelector" class="language-select">
                                    <option value="zh_CN" selected>简体中文</option>
                                    <option value="en_US">English</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background:#fff4e8; color:#f39c12;">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div class="settings-name">主题</div>
                            </div>
                            <div class="settings-value">默认</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background:#f0f0ff; color:#9b59b6;">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="settings-name">通知设置</div>
                            </div>
                            <div class="settings-value">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notificationToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-item" id="clearDataBtn">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background:#ffebeb; color:#e74c3c;">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <div class="settings-name">清除数据</div>
                            </div>
                            <div class="settings-value">
                                <button class="btn-clear-data">清除</button>
                            </div>
                        </div>
                    </div>
                `;

                modalBody.innerHTML = settingsHTML;

                // 添加语言选择事件
                const languageSelector = modalBody.querySelector('#languageSelector');
                if (languageSelector) {
                    languageSelector.addEventListener('change', function() {
                        const selectedLanguage = this.value;
                        changeAppLanguage(selectedLanguage);
                    });
                }

                // 添加清除数据事件
                const clearDataBtn = modalBody.querySelector('.btn-clear-data');
                if (clearDataBtn) {
                    clearDataBtn.addEventListener('click', function() {
                        if (confirm('确定要清除所有数据吗？此操作不可恢复！')) {
                            DataStore.bills = [];
                            DataStore.budgets = {
                                monthly: 0,
                                categories: {}
                            };
                            DataStore.saveData();
                            showToast('数据已清除');
                            
                            // 更新所有数据显示
                            updateTransactionList();
                            updateSummary();
                            updateBudgetDisplay();
                            updateBillsList();
                            updateBillsSummary();
                            updateProfileSummary();
                            
                            // 关闭模态窗口
                            hideModal(document.getElementById('settingsModal'));
                        }
                    });
                }

                // 添加通知设置事件
                const notificationToggle = modalBody.querySelector('#notificationToggle');
                if (notificationToggle) {
                    // 从本地存储加载通知设置
                    const notificationEnabled = localStorage.getItem('notificationEnabled') !== 'false';
                    notificationToggle.checked = notificationEnabled;
                    
                    notificationToggle.addEventListener('change', function() {
                        localStorage.setItem('notificationEnabled', this.checked);
                        showToast(this.checked ? '通知已开启' : '通知已关闭');
                    });
                }

                console.log('Settings modal populated');
            } catch (error) {
                console.error('Error populating settings modal:', error);
            }
        }
        
        // 切换应用语言的函数
        function changeAppLanguage(language) {
            try {
                // 默认使用中文
                let translations = {
                    appTitle: '西瓜账本',
                    home: '首页',
                    statistics: '统计',
                    bills: '账单',
                    profile: '我的',
                    expense: '支出',
                    income: '收入',
                    balance: '结余',
                    todayOverview: '今日概况',
                    recentBills: '近期账单',
                    noBillsYet: '暂无账单记录',
                    addNewBill: '点击右下角"+"添加新账单',
                    budgetManagement: '预算管理',
                    notifications: '消息通知',
                    settings: '设置',
                    commonQuestions: '常见问题',
                    aboutUs: '关于我们',
                    monthlySummary: '本月收入',
                    monthlyExpense: '本月支出',
                    monthlyBalance: '本月结余',
                    dataBackedUp: '数据已备份',
                    dataCleared: '数据已清除',
                    confirmClearData: '确定要清除所有数据吗？此操作不可恢复！',
                    backup: '数据备份',
                    clear: '清除',
                    import: '数据导入',
                    importSuccess: '数据导入成功',
                    importFail: '导入失败',
                    currency: '人民币 (¥)',
                    theme: '默认',
                    avatar: '头像已更新'
                };
                
                // 英文翻译
                if (language === 'en_US') {
                    translations = {
                        appTitle: 'Watermelon Bookkeeping',
                        home: 'Home',
                        statistics: 'Stats',
                        bills: 'Bills',
                        profile: 'Profile',
                        expense: 'Expense',
                        income: 'Income',
                        balance: 'Balance',
                        todayOverview: 'Today Overview',
                        recentBills: 'Recent Bills',
                        noBillsYet: 'No bills yet',
                        addNewBill: 'Click "+" to add a new bill',
                        budgetManagement: 'Budget Management',
                        notifications: 'Notifications',
                        settings: 'Settings',
                        commonQuestions: 'FAQ',
                        aboutUs: 'About Us',
                        monthlySummary: 'Monthly Income',
                        monthlyExpense: 'Monthly Expense',
                        monthlyBalance: 'Monthly Balance',
                        dataBackedUp: 'Data backed up',
                        dataCleared: 'Data cleared',
                        confirmClearData: 'Are you sure you want to clear all data? This action cannot be undone!',
                        backup: 'Backup',
                        clear: 'Clear',
                        import: 'Import',
                        importSuccess: 'Data imported successfully',
                        importFail: 'Import failed',
                        currency: 'USD ($)',
                        theme: 'Default',
                        avatar: 'Avatar updated'
                    };
                }
                // 日语翻译 
                else if (language === 'ja_JP') {
                    translations = {
                        appTitle: 'スイカ家計簿',
                        home: 'ホーム',
                        statistics: '統計',
                        bills: '明細',
                        profile: 'プロフィール',
                        expense: '支出',
                        income: '収入',
                        balance: '残高',
                        todayOverview: '今日の概要',
                        recentBills: '最近の明細',
                        noBillsYet: '明細はまだありません',
                        addNewBill: '「+」をクリックして新しい明細を追加',
                        budgetManagement: '予算管理',
                        notifications: 'お知らせ',
                        settings: '設定',
                        commonQuestions: 'よくある質問',
                        aboutUs: 'このアプリについて',
                        monthlySummary: '月間収入',
                        monthlyExpense: '月間支出',
                        monthlyBalance: '月間残高',
                        dataBackedUp: 'データをバックアップしました',
                        dataCleared: 'データを消去しました',
                        confirmClearData: '本当にすべてのデータを消去しますか？この操作は元に戻せません！',
                        backup: 'バックアップ',
                        clear: '消去',
                        import: 'インポート',
                        importSuccess: 'データのインポートに成功しました',
                        importFail: 'インポートに失敗しました',
                        currency: '円 (¥)',
                        theme: 'デフォルト',
                        avatar: 'アバターを更新しました'
                    };
                }
                
                // 存储当前语言设置
                localStorage.setItem('app_language', language);
                
                // 更新UI元素
                document.querySelectorAll('.watermelon-icon + span').forEach(el => {
                    el.textContent = translations.appTitle;
                });
                
                // 更新导航栏
                const navItems = document.querySelectorAll('.nav-item .nav-text');
                if (navItems.length >= 4) {
                    navItems[0].textContent = translations.home;
                    navItems[1].textContent = translations.statistics;
                    navItems[2].textContent = translations.bills;
                    navItems[3].textContent = translations.profile;
                }
                
                // 更新个人中心页面菜单项
                document.querySelector('#budgetManagement .menu-title').textContent = translations.budgetManagement;
                document.querySelector('#notifications .menu-title').textContent = translations.notifications;
                document.querySelector('#settings .menu-title').textContent = translations.settings;
                document.querySelector('#commonQuestions .menu-title').textContent = translations.commonQuestions;
                document.querySelector('#aboutUs .menu-title').textContent = translations.aboutUs || '关于';
                
                // 更新个人中心页面统计摘要
                const statsLabels = document.querySelectorAll('.profile-stats .stats-label');
                if (statsLabels.length >= 3) {
                    statsLabels[0].textContent = translations.monthlySummary;
                    statsLabels[1].textContent = translations.monthlyExpense;
                    statsLabels[2].textContent = translations.monthlyBalance;
                }
                
                // 更新数据管理按钮
                document.querySelector('#dataBackup span').textContent = translations.backup || '数据备份';
                document.querySelector('#dataImport span').textContent = translations.import || '数据导入';
                
                // 显示语言已切换的提示
                showToast(`Language changed to ${language.split('_')[0]}`);
                
                console.log('App language changed to:', language);
            } catch (error) {
                console.error('Error changing app language:', error);
            }
        }

        // 填充常见问题模态窗口内容
        function populateCommonQuestionsModal() {
            try {
                const modalBody = document.querySelector('#commonQuestionsModal .modal-body');
                if (!modalBody) return;

                // 常见问题数据
                const faqData = [
                    {
                        question: '如何添加新的收入或支出？',
                        answer: '点击屏幕底部的"+"按钮，选择收入或支出类型，填写金额和相关信息，然后点击保存即可添加新的账单记录。',
                        icon: 'fa-plus-circle',
                        color: '#2ecc71'
                    },
                    {
                        question: '如何设置预算？',
                        answer: '在个人中心页面点击"预算管理"，可以设置月度总预算金额。系统会根据您的支出情况自动计算预算使用情况。',
                        icon: 'fa-chart-line',
                        color: '#f39c12'
                    },
                    {
                        question: '如何查看统计报表？',
                        answer: '点击底部导航栏的"统计"选项，可以查看日/周/月/年的消费统计图表，了解您的消费分布情况。',
                        icon: 'fa-chart-pie',
                        color: '#3498db'
                    },
                    {
                        question: '如何修改或删除账单？',
                        answer: '在账单列表中，左滑任意账单条目，点击出现的"删除"按钮即可删除该账单。目前暂不支持直接修改账单，您可以删除后重新添加。',
                        icon: 'fa-edit',
                        color: '#e74c3c'
                    },
                    {
                        question: '数据会同步到云端吗？',
                        answer: '目前西瓜账本采用本地存储方式，数据保存在您的设备上。建议定期在"设置"中使用数据备份功能，导出数据以防丢失。',
                        icon: 'fa-cloud',
                        color: '#9b59b6'
                    }
                ];

                // 构建FAQ HTML
                let faqHTML = `<div class="faq-list">`;
                
                faqData.forEach((faq, index) => {
                    faqHTML += `
                        <div class="faq-item" data-index="${index}">
                            <div class="faq-question">
                                <div class="faq-icon" style="background:${faq.color}20; color:${faq.color}">
                                    <i class="fas ${faq.icon}"></i>
                                </div>
                                <span>${faq.question}</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">${faq.answer}</div>
                        </div>
                    `;
                });

                faqHTML += `</div>`;
                modalBody.innerHTML = faqHTML;

                // 添加问题点击展开/收起事件
                modalBody.querySelectorAll('.faq-item').forEach(item => {
                    const question = item.querySelector('.faq-question');
                    const answer = item.querySelector('.faq-answer');
                    const icon = question.querySelector('.fa-chevron-down');
                    
                    question.addEventListener('click', function() {
                        // 切换展开状态
                        const isExpanded = answer.style.maxHeight !== '0px' && answer.style.maxHeight !== '';
                        
                        if (isExpanded) {
                            answer.style.maxHeight = '0px';
                            answer.style.padding = '0 15px';
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            answer.style.maxHeight = answer.scrollHeight + 30 + 'px';
                            answer.style.padding = '15px';
                            icon.style.transform = 'rotate(180deg)';
                        }
                    });
                });

                console.log('FAQ modal populated');
            } catch (error) {
                console.error('Error populating FAQ modal:', error);
            }
        }

        // 填充关于我们模态窗口内容
        function populateAboutModal() {
            try {
                const modalBody = document.querySelector('#aboutModal .modal-body');
                if (!modalBody) return;

                // 构建关于我们内容
                const aboutHTML = `
                    <div class="about-content">
                        <div class="app-logo">
                            <i class="fas fa-umbrella-beach"></i>
                        </div>
                        <div class="app-name">西瓜账本</div>
                        <div class="app-version">版本 1.0.0</div>
                        <div class="app-description">
                            西瓜账本是一款简洁易用的个人记账应用，帮助您轻松管理日常收支，
                            科学规划预算，让您的财务状况一目了然。
                            <br><br>
                            特色功能：
                            <br>
                            - 直观的收支记录<br>
                            - 智能的预算管理<br>
                            - 多维度的统计分析<br>
                            - 简洁美观的界面设计
                            <br><br>
                            © 2025 西瓜账本团队
                        </div>
                    </div>
                `;

                modalBody.innerHTML = aboutHTML;
                console.log('About modal populated');
            } catch (error) {
                console.error('Error populating about modal:', error);
            }
        }

        // 显示头像编辑模态窗口
        function showAvatarEditModal() {
            try {
                // 防止重复创建模态窗口
                if (document.getElementById('avatarEditModal')) {
                    console.log('Avatar edit modal already exists');
                    return;
                }
                
                // 创建模态窗口
                const modal = document.createElement('div');
                modal.id = 'avatarEditModal';
                modal.className = 'modal';
                
                // 检查用户是否已设置头像
                const profileAvatar = document.querySelector('.profile-avatar');
                const avatarImg = profileAvatar.querySelector('img');
                const isDefaultAvatar = avatarImg.style.display === 'none' || avatarImg.complete === false;
                
                // 获取当前头像源
                const currentAvatarSrc = isDefaultAvatar ? '' : avatarImg.src;
                
                // 创建模态内容
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>编辑头像</h2>
                            <span class="close-modal">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="avatar-edit-content">
                                <div class="current-avatar">
                                    ${isDefaultAvatar ? 
                                      '<div class="default-avatar-icon"><i class="fas fa-user"></i></div>' : 
                                      `<img src="${currentAvatarSrc}" alt="当前头像">`}
                                </div>
                                <div class="avatar-options">
                                    <button class="btn btn-primary upload-btn">
                                        <i class="fas fa-upload"></i> 上传照片
                                    </button>
                                    <input type="file" id="avatarUpload" style="display:none" accept="image/*">
                                    <p class="avatar-hint">${isDefaultAvatar ? '您尚未设置头像，请上传一张照片' : '支持jpg、png格式，大小不超过2MB'}</p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-cancel" id="cancelAvatarEdit">取消</button>
                            <button class="btn btn-primary" id="saveAvatarEdit">保存</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // 显示模态窗口
                showModal(modal);
                
                // 关闭按钮事件
                modal.querySelector('.close-modal').addEventListener('click', function() {
                    hideModal(modal);
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 300);
                });
                
                // 取消按钮事件
                modal.querySelector('#cancelAvatarEdit').addEventListener('click', function() {
                    hideModal(modal);
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 300);
                });
                
                // 上传按钮事件
                const uploadBtn = modal.querySelector('.upload-btn');
                const fileInput = modal.querySelector('#avatarUpload');
                
                uploadBtn.addEventListener('click', function() {
                    fileInput.click();
                });
                
                // 文件选择事件
                fileInput.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const currentAvatar = modal.querySelector('.current-avatar');
                            currentAvatar.innerHTML = `<img src="${e.target.result}" alt="当前头像">`;
                        }
                        
                        reader.readAsDataURL(e.target.files[0]);
                    }
                });
                
                // 保存按钮事件
                modal.querySelector('#saveAvatarEdit').addEventListener('click', function() {
                    const avatarImage = modal.querySelector('.current-avatar img');
                    
                    if (avatarImage) {
                        // 更新个人中心页面的头像
                        const profileAvatarImg = document.querySelector('.profile-avatar img');
                        const defaultAvatarIcon = document.querySelector('.profile-avatar .default-avatar-icon');
                        
                        profileAvatarImg.src = avatarImage.src;
                        profileAvatarImg.style.display = 'block';
                        defaultAvatarIcon.style.display = 'none';
                        
                        // 保存到本地存储
                        localStorage.setItem('userAvatar', avatarImage.src);
                        
                        showToast('头像已更新');
                    } else {
                        showToast('请先上传头像');
                        return;
                    }
                    
                    hideModal(modal);
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 300);
                });
                
                // 点击模态窗口外部关闭
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        hideModal(modal);
                        setTimeout(() => {
                            document.body.removeChild(modal);
                        }, 300);
                    }
                });
                
                console.log('Avatar edit modal shown');
            } catch (error) {
                console.error('Error showing avatar edit modal:', error);
            }
        }

        // 初始化各个页面的数据
        updateBillsList();
        updateBudgetList();
        updateTransactionList();
        updateSummary();
        updateProfileSummary();
        initProfilePageMenus();

        // 数据备份功能
        function backupData() {
            try {
                const data = JSON.stringify({
                    bills: DataStore.bills,
                    categories: DataStore.categories,
                    budgets: DataStore.budgets
                });
                
                // 创建下载链接
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `watermelon_bookkeeping_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                
                // 清理
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
                
                showToast('数据已备份');
                console.log('Data backup completed');
            } catch (error) {
                console.error('Error backing up data:', error);
                showToast('备份失败，请重试');
            }
        }
        
        // 数据导入功能
        function importData() {
            try {
                // 创建文件输入元素
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.style.display = 'none';
                document.body.appendChild(fileInput);
                
                // 监听文件选择
                fileInput.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            try {
                                const importedData = JSON.parse(e.target.result);
                                
                                // 验证数据结构
                                if (!importedData.bills || !importedData.categories || !importedData.budgets) {
                                    throw new Error('无效的数据格式');
                                }
                                
                                // 确认导入
                                if (confirm(translations.confirmClearData)) {
                                    // 导入数据
                                    DataStore.bills = importedData.bills;
                                    DataStore.categories = importedData.categories;
                                    DataStore.budgets = importedData.budgets;
                                    DataStore.saveData();
                                    
                                    // 更新所有数据显示
                                    updateTransactionList();
                                    updateSummary();
                                    updateBudgetDisplay();
                                    updateBillsList();
                                    updateBillsSummary();
                                    updateProfileSummary();
                                    
                                    showToast(translations.importSuccess);
                                    console.log('Data import completed');
                                }
                            } catch (error) {
                                console.error('Error parsing imported data:', error);
                                showToast(translations.importFail);
                            }
                        };
                        
                        reader.readAsText(file);
                    }
                    
                    // 清理
                    document.body.removeChild(fileInput);
                });
                
                // 触发文件选择
                fileInput.click();
            } catch (error) {
                console.error('Error importing data:', error);
                showToast('导入失败，请重试');
            }
        }
        
        // 更新个人主页的摘要数据（全局函数）
        function updateProfileSummary() {
            try {
                console.log('Updating profile summary...');
                // 获取本月数据
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                // 计算本月账单
                const monthlyBills = DataStore.bills.filter(bill => {
                    const billDate = new Date(bill.date);
                    return billDate.getMonth() === currentMonth && 
                           billDate.getFullYear() === currentYear;
                });
                
                // 计算收入和支出
                const monthlyIncome = monthlyBills
                    .filter(bill => bill.type === 'income')
                    .reduce((sum, bill) => sum + bill.amount, 0);
                    
                const monthlyExpense = monthlyBills
                    .filter(bill => bill.type === 'expense')
                    .reduce((sum, bill) => sum + bill.amount, 0);
                
                // 注意：当前UI中不再显示月度摘要信息
                console.log('Profile summary data calculated: Income:', monthlyIncome, 'Expense:', monthlyExpense);
                
                console.log('Profile summary updated successfully');
            } catch (error) {
                console.error('Error updating profile summary:', error);
            }
        }

        // ... existing code ...
        // 事件初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            
            // 右上角通知图标点击事件
            const headerNotification = document.getElementById('headerNotification');
            if (headerNotification) {
                headerNotification.addEventListener('click', function() {
                    console.log('Header notification clicked');
                    populateNotificationsModal();
                    showModal(document.getElementById('notificationsModal'));
                });
                
                // 显示通知徽章
                const unreadNotifications = getUnreadNotificationsCount();
                if (unreadNotifications > 0) {
                    const badge = headerNotification.querySelector('.notification-badge');
                    if (badge) {
                        badge.textContent = unreadNotifications;
                        badge.style.display = 'flex';
                    }
                }
            }
            
            // 初始化搜索功能
            initSearchFunction();
            
            // 显示内容装饰
// ... existing code ...
        });

        // 获取未读通知数量
        function getUnreadNotificationsCount() {
            const notifications = [
                {
                    id: 1,
                    title: '预算提醒',
                    content: '您本月的餐饮预算已使用80%，请注意控制开支。',
                    time: '2023-06-01 08:30',
                    icon: 'fa-bell',
                    color: '#2ecc71',
                    read: false
                },
                {
                    id: 2,
                    title: '账单提醒',
                    content: '您有一笔¥328.50的账单已添加成功。',
                    time: '2023-05-30 14:15',
                    icon: 'fa-receipt',
                    color: '#3498db',
                    read: true
                },
                {
                    id: 3,
                    title: '系统通知',
                    content: '西瓜账本已更新到最新版本，体验全新功能。',
                    time: '2023-05-28 09:45',
                    icon: 'fa-info-circle',
                    color: '#e67e22',
                    read: true
                }
            ];
            
            return notifications.filter(notification => !notification.read).length;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            
            // 右上角通知图标点击事件
            const headerNotification = document.getElementById('headerNotification');
            if (headerNotification) {
                headerNotification.addEventListener('click', function() {
                    console.log('Header notification clicked');
                    populateNotificationsModal();
                    showModal(document.getElementById('notificationsModal'));
                });
                
                // 显示通知徽章
                const unreadNotifications = getUnreadNotificationsCount();
                if (unreadNotifications > 0) {
                    const badge = headerNotification.querySelector('.notification-badge');
                    if (badge) {
                        badge.textContent = unreadNotifications;
                        badge.style.display = 'flex';
                    }
                }
            }
            
            // 初始化搜索功能
            initSearchFunction();
            
            // 显示内容装饰
// ... existing code ...
        });

        // 更新账单时间显示函数
        function updateTransactionTimes() {
            const transactionDateElements = document.querySelectorAll('.transaction-date');
            transactionDateElements.forEach(element => {
                const date = element.getAttribute('data-date');
                const time = element.getAttribute('data-time');
                if (date) {
                    element.textContent = time || formatTime(date);
                }
            });
        }

        // 定期更新账单时间显示
        setInterval(updateTransactionTimes, 60000); // 每分钟更新一次

        // 初始化搜索功能
        function initSearchFunction() {
            try {
                // 获取搜索按钮和搜索模态窗口
                const searchButton = document.querySelector('#billsPage .header-right i.fa-search');
                const searchModal = document.getElementById('searchBillsModal');
                
                if (!searchButton || !searchModal) {
                    console.error('Search elements not found');
                    return;
                }
                
                // 添加搜索按钮点击事件
                searchButton.addEventListener('click', function() {
                    // 清空之前的搜索结果
                    const searchInput = document.getElementById('billSearchInput');
                    if (searchInput) searchInput.value = '';
                    
                    // 清空结果区域
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        // 保留no-data提示元素，但隐藏
                        const noData = searchResults.querySelector('.no-data');
                        searchResults.innerHTML = '';
                        if (noData) searchResults.appendChild(noData);
                        noData.style.display = 'none';
                    }
                    
                    // 显示搜索模态窗口
                    showModal(searchModal);
                });
                
                // 添加关闭按钮事件
                const closeButton = searchModal.querySelector('.close-modal');
                if (closeButton) {
                    closeButton.addEventListener('click', function() {
                        hideModal(searchModal);
                    });
                }
                
                // 设置搜索输入框事件
                const searchInput = document.getElementById('billSearchInput');
                const searchExpenseCheckbox = document.getElementById('searchExpense');
                const searchIncomeCheckbox = document.getElementById('searchIncome');
                
                if (searchInput && searchExpenseCheckbox && searchIncomeCheckbox) {
                    // 防抖处理搜索
                    let searchTimeout;
                    const performSearch = function() {
                        const query = searchInput.value.trim().toLowerCase();
                        const searchExpense = searchExpenseCheckbox.checked;
                        const searchIncome = searchIncomeCheckbox.checked;
                        
                        // 执行搜索
                        searchBills(query, searchExpense, searchIncome);
                    };
                    
                    // 输入框事件监听
                    searchInput.addEventListener('input', function() {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(performSearch, 300);
                    });
                    
                    // 复选框事件监听
                    searchExpenseCheckbox.addEventListener('change', performSearch);
                    searchIncomeCheckbox.addEventListener('change', performSearch);
                }
                
                console.log('Search functionality initialized');
            } catch (error) {
                console.error('Error initializing search function:', error);
            }
        }
        
        // 执行账单搜索
        function searchBills(query, searchExpense, searchIncome) {
            try {
                const searchResults = document.getElementById('searchResults');
                const noDataElem = searchResults.querySelector('.no-data');
                
                // 清空之前的结果，但保留no-data元素
                const childElems = Array.from(searchResults.children);
                childElems.forEach(child => {
                    if (!child.classList.contains('no-data')) {
                        child.remove();
                    }
                });
                
                // 如果查询为空且搜索条件为默认值，不执行搜索
                if (!query && searchExpense && searchIncome) {
                    noDataElem.style.display = 'none';
                    return;
                }
                
                // 如果没有选择任何类型，显示无数据
                if (!searchExpense && !searchIncome) {
                    noDataElem.style.display = 'flex';
                    return;
                }
                
                // 获取账单数据
                const bills = DataStore.bills || [];
                
                // 根据条件筛选数据
                const filteredBills = bills.filter(bill => {
                    // 筛选类型
                    if ((bill.type === 'expense' && !searchExpense) || 
                        (bill.type === 'income' && !searchIncome)) {
                        return false;
                    }
                    
                    // 如果查询为空，则返回所有符合类型的数据
                    if (!query) return true;
                    
                    // 查找分类名称
                    const category = DataStore.categories[bill.type].find(c => c.id === bill.category);
                    const categoryName = category ? category.name.toLowerCase() : '';
                    
                    // 查找备注
                    const note = (bill.note || '').toLowerCase();
                    
                    // 查找金额
                    const amount = bill.amount.toString();
                    
                    // 任一字段匹配即可
                    return categoryName.includes(query) || 
                           note.includes(query) || 
                           amount.includes(query);
                });
                
                if (filteredBills.length === 0) {
                    // 显示无结果
                    noDataElem.style.display = 'flex';
                    return;
                }
                
                // 隐藏无结果提示
                noDataElem.style.display = 'none';
                
                // 创建文档片段以提高性能
                const fragment = document.createDocumentFragment();
                
                // 按日期排序（最新的在前面）
                const sortedBills = filteredBills.sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time || '00:00:00'}`);
                    const dateB = new Date(`${b.date}T${b.time || '00:00:00'}`);
                    return dateB - dateA;
                });
                
                // 创建结果元素
                sortedBills.forEach(bill => {
                    const category = DataStore.categories[bill.type].find(c => c.id === bill.category);
                    
                    const div = document.createElement('div');
                    div.className = 'transaction-item';
                    div.setAttribute('data-id', bill.id);
                    
                    // 格式化金额
                    const formattedAmount = bill.amount.toLocaleString('zh-CN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    
                    div.innerHTML = `
                        <div class="transaction-content">
                            <div class="transaction-info">
                                <div class="category-icon">
                                    <i class="fas ${category?.icon || 'fa-question'}"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">${category?.name || '未分类'}</div>
                                    <div class="transaction-date" data-date="${bill.date}" data-time="${bill.time || '00:00:00'}">
                                        ${formatDate(bill.date)}${bill.note ? ' · ' + bill.note : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="transaction-amount ${bill.type}">
                                ${bill.type === 'expense' ? '-' : '+'}¥${formattedAmount}
                            </div>
                        </div>
                    `;
                    
                    fragment.appendChild(div);
                });
                
                // 添加到搜索结果区域
                searchResults.appendChild(fragment);
                
                // 更新时间格式
                updateTransactionTimes();
                
                console.log(`Search results: ${sortedBills.length} items found`);
            } catch (error) {
                console.error('Error searching bills:', error);
            }
        }

        // 页面加载完成后初始化
    </script>
</body>
</html>